{"id":45575,"title":"Plasmid Sequence Assembly from Long Reads","title_html":"<p>Plasmid Sequence Assembly from Long Reads<\/p>","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.bqrfmv3n","doi_status":2,"uri":"plasmid-sequence-assembly-from-long-reads-bqrfmv3n","type_id":1,"template_id":1,"published_on":1608069120,"parent_protocols":[],"parent_collections":[],"cited_protocols":[],"version_id":1,"version_data":{"id":"1","code":"bqrfmv3n","parent_id":45566,"parent_uri":"plasmid-sequence-assembly-from-long-reads-bqq6mvze","is_same_owner":true,"has_pending_merge_request":false,"has_approved_merge_request":true},"created_on":1608009591,"modified_on":null,"categories":null,"public":1,"is_unlisted":0,"creator":{"name":"David A. Eccles","affiliation":"Malaghan Institute of Medical Research (NZ)","affiliations":[{"affiliation":"Malaghan Institute of Medical Research (NZ)","url":"http:\/\/www.malaghan.org.nz\/","is_default":1}],"username":"david-eccles","note":null,"link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg"},"badges":[{"id":4,"image":{"source":"\/img\/badges\/gold.svg","placeholder":"\/img\/badges\/gold.svg"},"name":"Gold power author!"},{"id":6,"image":{"source":"\/img\/badges\/accelerator.svg","placeholder":"\/img\/badges\/accelerator.svg"},"name":"Science accelerator"}],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"has_versions":0,"link":"","total_collections":0,"number_of_steps":7,"authors":[{"name":"David Eccles","affiliation":"Malaghan Institute of Medical Research (NZ)","affiliations":[],"username":"david-eccles","note":null,"link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false}],"versions":[],"groups":[],"is_owner":1,"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_claim_authorship":0,"can_accept_authorship":0,"can_be_copied":1,"can_remove_fork":1,"fork_id":null,"url":"https:\/\/www.protocols.io\/view\/plasmid-sequence-assembly-from-long-reads-bqrfmv3n","forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"guid":"B454D23130C0493D9CBC37A78F29B9F3","state_version_id":177,"steps":[{"id":1093036,"guid":"814588283BB94E73A8F0E1F38F31D67C","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"A9C6142138BB422BAF27BF72B8C2E020","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"E55E4E31B7F949729DA931F170CD0C80","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Demultiplex reads as per protocol <\/div><div class = \"text-block\"><a href=\"https:\/\/dx.doi.org\/10.17504\/protocols.io.7vmhn46\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">Demultiplexing Nanopore reads with LAST<\/span><\/a><\/div><div class = \"text-block\">.<\/div><div class = \"text-block\">If this has been done, then the following command should produce output without errors:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">for bc in $(awk '{print $2}' barcode_counts.txt);<\/div><div class = \"text-block\">  do ls demultiplexed\/reads_${bc}.fq.gz;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Example output:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">demultiplexed\/reads_BC02.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC03.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC04.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC05.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC07.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC09.fq.gz<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">If the barcode_counts.txt file is missing, the output will look like this:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">awk: fatal: cannot open file `barcode_counts.txt' for reading (No such file or directory)<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">If one or more of the barcode-demultiplexed files are missing, the output will look something like this:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">demultiplexed\/reads_BC02.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC03.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC04.fq.gz<\/div><div class = \"text-block\">ls: cannot access 'demultiplexed\/reads_BC05.fq.gz': No such file or directory<\/div><div class = \"text-block\">ls: cannot access 'demultiplexed\/reads_BC07.fq.gz': No such file or directory<\/div><div class = \"text-block\">demultiplexed\/reads_BC09.fq.gz<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093037,"guid":"3E9B00C56D6247EFA269233C6AD58944","previous_id":1093036,"previous_guid":"814588283BB94E73A8F0E1F38F31D67C","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"E3C3FB70362B4F4292F9371390B79745","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"3D5C045D15D9431FAB5734E636B0EBC4","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Create a directory to store results files<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">mkdir results<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093038,"guid":"808307EC5AC74EDA9B6D2E78B92F0ABE","previous_id":1093037,"previous_guid":"3E9B00C56D6247EFA269233C6AD58944","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"4D92841808CB4036A88678A45483678E","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"8273E5701B1F4C97BEB246CB17D25637","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Determine the N50\/L50 read length for each barcode. This will be used as the initial guess at the assembly size.<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">(for bc in $(awk '{print $2}' barcode_counts.txt);<\/div><div class = \"text-block\">    do echo -n ${bc};<\/div><div class = \"text-block\">    fastx-length.pl demultiplexed\/reads_${bc}.fq.gz 2>&1 > \/dev\/null | \\<\/div><div class = \"text-block\">      grep L50 | awk '{print \"\\t\"$5$6}' | perl -pe 's\/b$\/\/';<\/div><div class = \"text-block\"> done) > results\/read_L50.txt<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">This file can be viewed to confirm the assembly lengths:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Example output:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">BC02    347<\/div><div class = \"text-block\">BC03    8.904k<\/div><div class = \"text-block\">BC04    8.888k<\/div><div class = \"text-block\">BC05    10.262k<\/div><div class = \"text-block\">BC07    11.076k<\/div><div class = \"text-block\">BC09    11.093k<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\"><span style = \"font-style:italic;\">Note: this file will be used for subsequent downstream processing. If any of these barcodes shouldn't be processed further, feel free to remove the corresponding lines from this file<\/span><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093039,"guid":"523662CCBBA74B80AFCBE929C2EBD8EC","previous_id":1093038,"previous_guid":"808307EC5AC74EDA9B6D2E78B92F0ABE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D44E9DA108B6450293FD4C3B8FD134FE","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read filitering"}},{"id":1054724,"guid":"1384B4ED73B74949BBBAAA285EB05B43","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Filter out any reads that are less than half of the target read length, and determine the average quality of the remainder, keeping information on (at most) 200 of the highest-quality reads:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  ~\/scripts\/fastx-compstats.pl demultiplexed\/reads_${bc}.fq.gz | \\<\/div><div class = \"text-block\">    sort -t ',' -k 16rn,16 | \\<\/div><div class = \"text-block\">    awk -F ',' -v \"len=${len}\" \\<\/div><div class = \"text-block\">      'BEGIN{if(match(len, \"k\") > 0){sub(\"k\",\"\",len); len=len*1000}}<\/div><div class = \"text-block\">       {if($18 > (len \/ 2)){print}}' | \\<\/div><div class = \"text-block\">    head -n 200 | grep -v '^name' > results\/bestLong_200X_${bc}.csv;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Check how successful the sequencer was at getting 200X coverage by counting lines:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">wc -l results\/bestLong_200X_*.csv<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Example output. In this case BC02 has fewer than 200 reads, so the assembly is less likely to be high-quality:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">  90 results\/bestLong_200X_BC02.csv<\/div><div class = \"text-block\"> 200 results\/bestLong_200X_BC03.csv<\/div><div class = \"text-block\"> 200 results\/bestLong_200X_BC04.csv<\/div><div class = \"text-block\"> 200 results\/bestLong_200X_BC05.csv<\/div><div class = \"text-block\"> 200 results\/bestLong_200X_BC07.csv<\/div><div class = \"text-block\"> 200 results\/bestLong_200X_BC09.csv<\/div><div class = \"text-block\">1090 total<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093040,"guid":"F8B36C7F4E36466A8B2E2C6A03E5B291","previous_id":1093039,"previous_guid":"523662CCBBA74B80AFCBE929C2EBD8EC","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D27830E737904FC18E1313F39FA27B3A","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read filitering"}},{"id":1054724,"guid":"1C64D6082E5046FE94BDE1B1CB441C1F","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Subset the original read sets to only include the high-quality long reads:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  ~\/scripts\/fastx-fetch.pl -i results\/bestLong_200X_${bc}.csv \\<\/div><div class = \"text-block\">    demultiplexed\/reads_${bc}.fq.gz > results\/bestLong_200X_${bc}.fastq; done<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093041,"guid":"41F4FD182A334C879A079FF3F3C1E777","previous_id":1093040,"previous_guid":"F8B36C7F4E36466A8B2E2C6A03E5B291","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"9F03E204EE6644ACB1C01FF255D22668","order_id":1,"type_id":6,"title":"Section","source":{"title":"Canu Assembly"}},{"id":1054724,"guid":"A724BB81E8B5402D8B1AB03175400EC6","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Run a Canu assembly on each read set, using default options:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do canu -nanopore results\/bestLong_200X_${bc}.fastq \\<\/div><div class = \"text-block\">    -p ${bc} -d results\/canu_${bc} genomeSize=${len};<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1093042,"guid":"066FC2A4E8BE4633A25CCED104826533","previous_id":1093041,"previous_guid":"41F4FD182A334C879A079FF3F3C1E777","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"5906EB138F3A4A958DC0BF4B777F6A2D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Canu Assembly"}},{"id":1054724,"guid":"EC9C8C1AB83A4A9D9CB9D4537141B469","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Trim the assembled contigs based on Canu's trim recommendations:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  samtools faidx results\/canu_${bc}\/${bc}.contigs.fasta \\<\/div><div class = \"text-block\">    $(grep '^>' results\/canu_${bc}\/${bc}.contigs.fasta | \\<\/div><div class = \"text-block\">      perl -pe 's\/^>(.*?) .*trim=(.*)\/$1:$2\/') > results\/circTrimmed_${bc}.fasta;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0}],"document":"","materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\">This protocol demonstrates how to assemble reads from plasmid DNA, and generate a circularised and non-repetitive consensus sequence<\/div><div class = \"text-block\">At the moment, this protocol uses Canu to de-novo assemble high-quality single-cut reads.<\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">Input(s)<\/span><span>: <\/span><\/div><div class = \"text-block\"><ul style = \"list-style-type:disc;\"><li style = \"counter-reset:ol0;list-style-type:disc;\"><span>demultiplexed fastq files (see protocol <\/span><a href=\"https:\/\/dx.doi.org\/10.17504\/protocols.io.7vmhn46\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">Demultiplexing Nanopore reads with LAST<\/span><\/a><span>). I've noticed that the default demultiplexing carried out by Guppy (at least up to v4.2.2, as used in the first version of this protocol) has issues with <\/span><a href=\"https:\/\/doi.org\/10.12688\/f1000research.11547.2\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">chimeric reads<\/span><\/a><span>, which can affect assembly.<\/span><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\"><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\"><span style = \"font-weight:bold;\">Output(s):<\/span><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\">Consensus sequence per barcode as a fasta file<\/li><\/ul><\/div><div class = \"text-block\"><span style = \"font-weight:bold;\">Output(s):<\/span><\/div><div class = \"text-block\"><ul style = \"list-style-type:disc;\"><\/ul><\/div><\/div>","changed_on":1608069120}