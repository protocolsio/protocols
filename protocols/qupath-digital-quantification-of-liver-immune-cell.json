{"id":48040,"title":"QuPath Digital Quantification of Liver Immune Cells","title_html":"<p>QuPath Digital Quantification of Liver Immune Cells<\/p>","image":{"source":"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7xvbizwf.jpg","placeholder":"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7xvbizwf.jpg"},"doi":"dx.doi.org\/10.17504\/protocols.io.bs6gnhbw","doi_status":2,"uri":"qupath-digital-quantification-of-liver-immune-cell-bs6gnhbw","type_id":1,"template_id":5,"published_on":1629129478,"parent_protocols":[],"parent_collections":[],"cited_protocols":[],"version_id":0,"version_data":{"id":0,"code":"bs6gnhbw","parent_id":0,"parent_uri":null,"has_pending_merge_request":0,"has_approved_merge_request":0},"created_on":1615323971,"modified_on":null,"categories":null,"public":1,"is_unlisted":0,"creator":{"name":" ","affiliation":null,"affiliations":[],"username":null,"note":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"has_versions":0,"link":null,"total_collections":0,"number_of_steps":19,"authors":[{"name":"Xinle Wang","affiliation":"University of Toronto","affiliations":[],"username":"xinle-wang","note":"","link":null,"image":{"source":"\/img\/avatars\/014.png","placeholder":"\/img\/avatars\/014.png"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Catia Perciani","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":"catia-perciani","note":"","link":null,"image":{"source":"\/img\/avatars\/003.png","placeholder":"\/img\/avatars\/003.png"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Xue-Zhong Ma","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Chao Jiang","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Justin Manuel","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Sai Chung","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Cornelia Thoeni","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Trevor McKee","affiliation":"Princess Margaret Cancer Centre STTARR Innovation Facility","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Ian McGilvray","affiliation":"Ajmera Family Transplant Centre","affiliations":[],"username":null,"note":"","link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},{"name":"Sonya Macparland","affiliation":"University of Toronto","affiliations":[],"username":"sonya-macparland","note":"","link":null,"image":{"source":"\/img\/avatars\/008.png","placeholder":"\/img\/avatars\/008.png"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false}],"versions":[],"groups":[],"is_owner":1,"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_claim_authorship":0,"can_accept_authorship":0,"can_be_copied":1,"can_remove_fork":1,"fork_id":null,"url":"https:\/\/www.protocols.io\/view\/qupath-digital-quantification-of-liver-immune-cell-bs6gnhbw","forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"guid":"3B579DF0811B11EB907D8B6C4037B20F","state_version_id":2564,"steps":[{"id":1141094,"guid":"7AE83330811B11EB8B25010F44FD9A26","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D0868E0A3A0A4C4A968A5E390D647E23","order_id":1,"type_id":6,"title":"Section","source":{"title":"Download, Import and Organize Images"}},{"id":1054724,"guid":"EE6EC5811A164DAF90C640094D2DB5AE","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Download open-source QuPath software from <\/div><div class = \"text-block\"><a href=\"http:\/\/qupath.github.io\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">http:\/\/qupath.github.io<\/span><\/a><\/div><div class = \"text-block\"><span style = \":UNDERLINE;\">. <\/span><span>To avoid incompatible features in newer versions of the software, refrain from changing software versions during the same analysis. <\/span><\/div><br\/><\/div>"}},{"id":1054725,"guid":"14289D40816811EB8B25010F44FD9A26","order_id":2,"type_id":8,"title":"software","source":{"name":"QuPath","developer":"Pete Bankhead","repository":null,"link":"http:\/\/qupath.github.io","os_name":null,"os_version":null}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#7ed321","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141355,"guid":"AA7CE380816A11EB8B25010F44FD9A26","previous_id":1141800,"previous_guid":"0AAC0B4081D011EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"95CEB90B627A45AF841C6E85786B86BC","order_id":1,"type_id":6,"title":"Section","source":{"title":"Sample Image Quality Control"}},{"id":1054724,"guid":"056B3FA9D46A46A5B9B5F1772693438B","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Before quantification analysis, it is important to assess the sample cohort for stain consistency. The same digital quantification parameters can only be applied to consistently stained samples. Depending on the liver sample examined, non-specific staining can occur despite identical staining protocol. In the case of inconsistent staining, the samples need to be segregated for low and high sensitivity digital cellular detection and analyzed separately to ensure true positivity capture.<\/div><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7xxbizwf.jpg\" \/><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"95723A5F3BEA4104B8F7666E2F8763E0","order_id":2,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7xxbizwf.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#d0021b","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141356,"guid":"A73BD760816C11EB8EB3FDE5E8BF38F7","previous_id":1141797,"previous_guid":"E20F9EE081CF11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"786B5AE04B654397B9EB94DB47FBEF29","order_id":1,"type_id":6,"title":"Section","source":{"title":"Image Annotation"}},{"id":1054724,"guid":"FF95B5FBFAB145F6BBB7BC2FA437560D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Annotate around the entire sample region of interest (ROI) using the magic wand icon. Note: Hold down on CTRL and SHIFT to avoid annotation overlap for artifact exclusion.<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#4a90e2","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141358,"guid":"34E7D8C0816D11EB8EB3FDE5E8BF38F7","previous_id":1192277,"previous_guid":"38F93F60C79711EB8632FB15182ECF35","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"F449FDDA53304E8896815F80FC24F7F4","order_id":1,"type_id":6,"title":"Section","source":{"title":"Analysis Optimization"}},{"id":1054724,"guid":"EC3E5BF8F25143AEB0735D285A0FDD83","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>In a particular ROI, optimize parameters for the positive cell detection module (<\/span><span style = \"font-weight:bold;\">Analyze <\/span><span>> <\/span><span style = \"font-weight:bold;\">Cell detection <\/span><span>> <\/span><span style = \"font-weight:bold;\">Positive cell detection<\/span><span>) to capture individual cells and positivity threshold for \"Cell: DAB OD mean\". Once satisfied with parameters, run optimized module on second and third ROI to validate. <\/span><\/div><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"6CBB34D3F0FC49CE8C0A5D631151258A","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">If using QuPath v.0.2.3, it is highly recommended to set the \"Background radius\" parameter to a negative value prior to optimizing remaining parameters, to avoid detection issues that lead to uneven tiling detection.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054726,"guid":"B7D290392A524DA78474C30413475F7F","order_id":3,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">It is recommended to perform manual positive cell annotations with the \"Points\" annotation function in a select ROI when optimizing. Annotate and save all points annotations. \"Measurement maps\" (Measure>Show measurement maps) can be used to facilitate optimization in real time. Select \"Cell: DAB OD Mean\" and use scale bar to locate optimal positivity threshold. The optimal positivity threshold can be determined with overlapping points annotations map colour. <\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#f5a623","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141359,"guid":"56B34660816D11EB8EB3FDE5E8BF38F7","previous_id":1192283,"previous_guid":"01D33F30C79811EB8632FB15182ECF35","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"98B937E391C24C93BC75BB5F95811E70","order_id":1,"type_id":6,"title":"Section","source":{"title":"Run Analysis"}},{"id":1054724,"guid":"53111FCDD1264343BF7813F196DB76BA","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Open saved positive cell detection script (<\/span><span style = \"font-weight:bold;\">Automate<\/span><span> > <\/span><span style = \"font-weight:bold;\">Show script editor<\/span><span>). Run script for analysis (<\/span><span style = \"font-weight:bold;\">Run<\/span><span> > <\/span><span style = \"font-weight:bold;\">Run<\/span><span>) for single analysis of current image. For multiple image processing or batch processing, select \"Run for project\" and choose images to assess.<\/span><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"E51E8571777E4276937DEC4B3CC5822B","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">Images to be analyzed need to be closed in viewer before batch processing.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#9013fe","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141360,"guid":"6C87CE70816D11EB8EB3FDE5E8BF38F7","previous_id":1192292,"previous_guid":"37A41A30C79811EB8632FB15182ECF35","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"1C85681F132E4234B4A7B5B410BED523","order_id":1,"type_id":6,"title":"Section","source":{"title":"Export Results"}},{"id":1054724,"guid":"C98D5EF9385A460CA64025DAB36004CA","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Export detection results for all annotations (<\/span><span style = \"font-weight:bold;\">Export<\/span><span> > <\/span><span style = \"font-weight:bold;\">Export Measurements<\/span><span>).<\/span><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"4A15D2B000BA4502BEF9F303A1984C7D","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">For annotation detection results of liver lobule locational analysis, select \"Annotations\" in \"Export Type\".<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#f8e71c","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141797,"guid":"E20F9EE081CF11EB8EB3FDE5E8BF38F7","previous_id":1141355,"previous_guid":"AA7CE380816A11EB8B25010F44FD9A26","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"5735F3EFE5934334B9DC84DB0874ED88","order_id":1,"type_id":6,"title":"Section","source":{"title":"Sample Image Quality Control"}},{"id":1054724,"guid":"F445AF08AEAA4ABF85A33DE1AFA28D2D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Each individual image should be assessed for stain and slide preparation artifacts. The artifacts will be excluded from digital analysis. To exclude artifacts, either avoid artifact when annotating for sample by holding down CTRL and SHIFT, or annotate the artifact only using the annotation tools post-analysis, select all detections, insert detections into hierarchy and delete the artifact annotation (not keeping object detections).<\/div><br\/><br\/><br\/><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7x3bizwf.jpg\" \/><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"689FD26CA4CC4A11B97B8686E80F7AA5","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Video instructions available at <\/span><a href=\"https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0<\/span><\/a><\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054726,"guid":"C6481768D064496EB845BF6409A360EC","order_id":3,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7x3bizwf.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141798,"guid":"F6CF0D7081CF11EB8EB3FDE5E8BF38F7","previous_id":1141094,"previous_guid":"7AE83330811B11EB8B25010F44FD9A26","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"2CE6CBC9A0A5411285AE3D1CAFB6ED3C","order_id":1,"type_id":6,"title":"Section","source":{"title":"Download, Import and Organize Images"}},{"id":1054724,"guid":"0E2E3A4BDD964F06B391B2C8C1953A7D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Open QuPath software and set initial preferences using the gear icon or from the menu (<\/span><span style = \"font-weight:bold;\">Edit <\/span><span style = \"font-weight:bold;font-weight:bold;\">><\/span><span style = \"font-weight:bold;\"> Preference<\/span><span>). It is recommended to set \"Set image type\" as \"Auto estimate\" in <\/span><span style = \"font-weight:bold;\">Preference <\/span><span>> <\/span><span style = \"font-weight:bold;\">General<\/span><span>. This will enable the software to estimate image type as hematoxylin & eosin (H&E), horseradish peroxidase-based 3,3\u2032-diaminobenzidine (H-DAB) or fluorescence without prompting user to manually enter for each image.<\/span><\/div><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7x7bizwf.jpg\" \/><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"14C5CCC39F074FF98EE5A6C862ACFFF9","order_id":2,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7x7bizwf.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#7ed321","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141799,"guid":"020F262081D011EB8EB3FDE5E8BF38F7","previous_id":1141798,"previous_guid":"F6CF0D7081CF11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"6023D12C7AB5407CAE25410ABFD5DD1D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Download, Import and Organize Images"}},{"id":1054724,"guid":"DCDF11D0453848C1A8CD7B4137C14958","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Create new project in a new, empty folder with<\/span><span style = \"font-weight:bold;\"> Create project<\/span><span> button. All files associated with the project will be saved into this folder and can be accessed through the <\/span><span style = \"font-weight:bold;\">Open project<\/span><span> button.<\/span><\/div><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7ybbizwf.jpg\" \/><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"F9704730632D408F8EB8647F7023CF5B","order_id":2,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7ybbizwf.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#7ed321","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1141800,"guid":"0AAC0B4081D011EB8EB3FDE5E8BF38F7","previous_id":1141799,"previous_guid":"020F262081D011EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"3861307A637C445FB263C677D8967CBB","order_id":1,"type_id":6,"title":"Section","source":{"title":"Download, Import and Organize Images"}},{"id":1054724,"guid":"C2C2B7F5BCA846468D9D870F68009DD3","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Import sample images through dragging and dropping onto QuPath interface. Image names that are italicized correspond to unprocessed images. To facilitate organization, images can be assigned a <\/span><span style = \"font-weight:bold;\">metadata<\/span><span> to categorize based on user-inputted \"key\" and \"value\" (e.g. key = stain and value = CD68 to mark macrophages). The images can be sorted by right clicking the project title and selecting <\/span><span style = \"font-weight:bold;\">Sort by...<\/span><span> > <\/span><span style = \"font-weight:bold;\">key name<\/span><\/div><br\/><br\/><br\/><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7yfbizwf.jpg\" \/><\/div><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"CA20DAB9168843BB8A4690A8CE08CCE7","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Video instructions available at <\/span><a href=\"https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0<\/span><\/a><\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054726,"guid":"1AB3EA365D45421FB995EDD3B3B4CBF0","order_id":3,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7yfbizwf.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#7ed321","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1142215,"guid":"AE334340820311EB8EB3FDE5E8BF38F7","previous_id":1176587,"previous_guid":"D66486D0B28C11EB9164D7F78321ADCE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"4BFC7A435A5A433BB35DDF6DC92BBF64","order_id":1,"type_id":6,"title":"Section","source":{"title":"Spatial Lobular Analysis"}},{"id":1054724,"guid":"434AA4D524064B428DB55D6E37B699B9","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">For concentrical locational analysis of periportal versus pericentral immune cells, locate and annotate liver lobule regions. Set all lobule annotations to class \"Other\" and save annotations using Save Annotation script below. Once saved, further concentrical partition using partitioning script below. <\/div><br\/><br\/><br\/><br\/><br\/><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"6B72814BC6EF490EADD6E5AD39DFF064","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">In cases where the entirety of the liver lobule cannot be identified, an alternative rectangular locational partition can be applied (See step 9)<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054726,"guid":"AF74D82872174D9BA89EC4A70D83D421","order_id":3,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">The partitioning script is coded to delete original lobule annotation. It is important to save lobule annotations before running partition script. The annotations can be restored using the Restore Annotation Script below.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054727,"guid":"5C58E110820811EB8EB3FDE5E8BF38F7","order_id":4,"type_id":15,"title":"command","source":{"id":8658,"name":"hierarchy = getCurrentHierarchy()\nimageName = getProjectEntry().getImageName()\npath = buildFilePath(PROJECT_BASE_DIR, \"testSetPoints\")\nmkdirs(path)\n\npath = buildFilePath(PROJECT_BASE_DIR, \"testSetPoints\", imageName+\".testROI\")\n\nannotations = getAnnotationObjects().findAll{it.getPathClass() == getPathClass(\"Other\")}.collect {new qupath.lib.objects.PathAnnotationObject(it.getROI(), it.getPathClass())}\n\ndef gson = GsonTools.getInstance(true)\n\npath = buildFilePath(PROJECT_BASE_DIR, \"testSetPoints\", imageName+\".testarea\")\nFile file = new File(path)\nfile.write(gson.toJson(annotations))","command_name":"Save Annotation Script","command":"Script modified to save all annotations of class \"Other\" into project folder.","os_name":null,"os_version":null}},{"id":1054728,"guid":"9E634D85FD6D4B1EADFFE18F41B50C07","order_id":5,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">User should input \"line length\" (length of lobule side to lobule centre) and \"ROIName\" (e.g. ROI1) into Partitioning Script.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054729,"guid":"6B69D7E0820811EB8EB3FDE5E8BF38F7","order_id":6,"type_id":15,"title":"command","source":{"id":8657,"name":"\/**\n* written up  https:\/\/petebankhead.github.io\/qupath\/scripts\/2018\/08\/08\/three-regions.html\n* @author Pete Bankhead\n* modified to make inner margin rings to identify centroid regions within liver lobules for quantification.\n* Modifications by Trevor McKee and Xinle Wang, version 18-Feb-2021\n*\/\n\nimport org.locationtech.jts.geom.Geometry\nimport qupath.lib.common.GeneralTools\nimport qupath.lib.objects.PathObject\nimport qupath.lib.objects.PathObjects\nimport qupath.lib.roi.GeometryTools\nimport qupath.lib.roi.ROIs\n\nimport static qupath.lib.gui.scripting.QPEx.*\n\n\/\/-----\n\/\/ Some things user need to specify\n\n\/\/ How much to expand each region\ndouble linelength = 313  \/\/ User input - edit this to specify line length\ndef ROIName = \"ROI 3\" \/\/ User input - change this to change the labeling for each ring\ndouble expandMarginMicrons = -linelength\/10.0\n\n\/\/ Define the colors\ndef coloInner9Margin = getColorRGB(0, 50, 0)\ndef coloInner8Margin = getColorRGB(0, 100, 0)\ndef coloInner7Margin = getColorRGB(0, 150, 0)\ndef coloInner6Margin = getColorRGB(0, 200, 0)\ndef coloInner5Margin = getColorRGB(0, 250, 0)\ndef coloInner4Margin = getColorRGB(0, 0, 50)\ndef coloInner3Margin = getColorRGB(0, 0, 100)\ndef coloInner2Margin = getColorRGB(0, 0, 200)\ndef colorOuterMargin = getColorRGB(0, 0, 250)\ndef colorCentral = getColorRGB(0, 0, 0)\n\n\/\/ Choose whether to lock the annotations or not (it's generally a good idea to avoid accidentally moving them)\ndef lockAnnotations = true\n\n\/\/-----\n\n\/\/ Extract the main info we need\ndef imageData = getCurrentImageData()\ndef hierarchy = imageData.getHierarchy()\ndef server = imageData.getServer()\n\n\/\/ We need the pixel size\ndef cal = server.getPixelCalibration()\nif (!cal.hasPixelSizeMicrons()) {\n  print 'We need the pixel size information here!'\n  return\n}\nif (!GeneralTools.almostTheSame(cal.getPixelWidthMicrons(), cal.getPixelHeightMicrons(), 0.0001)) {\n  print 'Warning! The pixel width & height are different; the average of both will be used'\n}\n\n\/\/ Get annotation & detections\ndef annotations = getAnnotationObjects()\ndef selected = getSelectedObject()\nif (selected == null || !selected.isAnnotation()) {\n  print 'Please select an annotation object!'\n  return\n}\n\n\n\/\/ We need one selected annotation as a starting point; if we have other annotations, they will constrain the output\nannotations.remove(selected)\n\n\/\/ Extract the ROI & plane\ndef roiOriginal = selected.getROI()\ndef plane = roiOriginal.getImagePlane()\n\n\n\/\/ Calculate how much to expand\ndouble expandPixels = expandMarginMicrons \/ cal.getAveragedPixelSizeMicrons()\ndef areaTumor = roiOriginal.getGeometry()\ndef TissueAnnotation = areaTumor\n\n\/\/ Get the first central area\ndef geomCentral = areaTumor.buffer(expandPixels)\n\/\/geomCentral = geomCentral.intersection(areaTissue)\ndef roiCentral = GeometryTools.geometryToROI(geomCentral, plane)\ndef annotationCentral = PathObjects.createAnnotationObject(roiCentral)\nannotationCentral.setName(\"Central Region\")\nannotationCentral.setColorRGB(colorCentral)\n\n\/\/ Get the first inner margin area\ndef geomInner = areaTumor\ngeomInner = geomInner.difference(geomCentral)\n\/\/geomInner = geomInner.intersection(areaTissue)\ndef roiInner = GeometryTools.geometryToROI(geomInner, plane)\ndef annotationInner = PathObjects.createAnnotationObject(roiInner)\nannotationInner.setName(\"1st Ring \" + ROIName)\nannotationInner.setColorRGB(colorOuterMargin)\n\n\/\/ Get the second central area\ndef geomCentral2 = geomCentral.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral2 = geomCentral2.intersection(geomCentral)\ndef roiCentral2 = GeometryTools.geometryToROI(geomCentral2, plane)\ndef annotationCentral2 = PathObjects.createAnnotationObject(roiCentral2)\nannotationCentral2.setName(\"Second Inner Ring\")\nannotationCentral2.setColorRGB(colorCentral)\n\n\/\/ Get the 2nd inner margin area\ndef geomInner1 = geomCentral\ngeomInner1 = geomCentral.difference(geomCentral2)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner1 = GeometryTools.geometryToROI(geomInner1, plane)\ndef annotationInner2 = PathObjects.createAnnotationObject(roiInner1)\nannotationInner2.setName(\"2nd Ring \" + ROIName)\nannotationInner2.setColorRGB(coloInner2Margin)\n\n\/\/ Get the 3rd central area\ndef geomCentral3 = geomCentral2.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral3 = geomCentral3.intersection(geomCentral2)\ndef roiCentral3 = GeometryTools.geometryToROI(geomCentral3, plane)\ndef annotationCentral3 = PathObjects.createAnnotationObject(roiCentral3)\nannotationCentral3.setName(\"Third Inner Ring\")\nannotationCentral3.setColorRGB(colorCentral)\n\n\/\/ Get the 3rd inner margin area\ndef geomInner2 = geomCentral2\ngeomInner2 = geomCentral2.difference(geomCentral3)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner2 = GeometryTools.geometryToROI(geomInner2, plane)\ndef annotationInner3 = PathObjects.createAnnotationObject(roiInner2)\nannotationInner3.setName(\"3rd Ring \" + ROIName)\nannotationInner3.setColorRGB(coloInner3Margin)\n\n\/\/ Get the 4th central area\ndef geomCentral4 = geomCentral3.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral4 = geomCentral4.intersection(geomCentral3)\ndef roiCentral4 = GeometryTools.geometryToROI(geomCentral4, plane)\ndef annotationCentral4 = PathObjects.createAnnotationObject(roiCentral4)\nannotationCentral4.setName(\"Third Inner Ring\")\nannotationCentral4.setColorRGB(colorCentral)\n\n\/\/ Get the 4th inner margin area\ndef geomInner3 = geomCentral3\ngeomInner3 = geomCentral3.difference(geomCentral4)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner3 = GeometryTools.geometryToROI(geomInner3, plane)\ndef annotationInner4 = PathObjects.createAnnotationObject(roiInner3)\nannotationInner4.setName(\"4th Ring \" + ROIName)\nannotationInner4.setColorRGB(coloInner4Margin)\n\n\/\/ Get the 5th central area\ndef geomCentral5 = geomCentral4.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral5 = geomCentral5.intersection(geomCentral4)\ndef roiCentral5 = GeometryTools.geometryToROI(geomCentral5, plane)\ndef annotationCentral5 = PathObjects.createAnnotationObject(roiCentral5)\nannotationCentral5.setName(\"Third Inner Ring\")\nannotationCentral5.setColorRGB(colorCentral)\n\n\/\/ Get the 5th inner margin area\ndef geomInner4 = geomCentral4\ngeomInner4 = geomCentral4.difference(geomCentral5)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner4 = GeometryTools.geometryToROI(geomInner4, plane)\ndef annotationInner5 = PathObjects.createAnnotationObject(roiInner4)\nannotationInner5.setName(\"5th Ring \" + ROIName)\nannotationInner5.setColorRGB(coloInner5Margin)\n\n\/\/ Get the 6th central area\ndef geomCentral6 = geomCentral5.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral6 = geomCentral6.intersection(geomCentral5)\ndef roiCentral6 = GeometryTools.geometryToROI(geomCentral6, plane)\ndef annotationCentral6 = PathObjects.createAnnotationObject(roiCentral6)\nannotationCentral6.setName(\"Third Inner Ring\")\nannotationCentral6.setColorRGB(colorCentral)\n\n\/\/ Get the 6th inner margin area\ndef geomInner5 = geomCentral5 \/\/ change from geomcentral6\ngeomInner5 = geomCentral5.difference(geomCentral6)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner5 = GeometryTools.geometryToROI(geomInner5, plane)\ndef annotationInner6 = PathObjects.createAnnotationObject(roiInner5)\nannotationInner6.setName(\"6th Ring \" + ROIName)\nannotationInner6.setColorRGB(coloInner6Margin)\n\n\n\/\/ Get the 7th central area\ndef geomCentral7 = geomCentral6.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral7 = geomCentral7.intersection(geomCentral6)\ndef roiCentral7 = GeometryTools.geometryToROI(geomCentral7, plane)\ndef annotationCentral7 = PathObjects.createAnnotationObject(roiCentral7)\nannotationCentral7.setName(\"Third Inner Ring\")\nannotationCentral7.setColorRGB(colorCentral)\n\n\/\/ Get the 7th inner margin area\ndef geomInner6 = geomCentral6 \/\/ change from geomcentral7\ngeomInner6 = geomCentral6.difference(geomCentral7)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner6 = GeometryTools.geometryToROI(geomInner6, plane)\ndef annotationInner7 = PathObjects.createAnnotationObject(roiInner6)\nannotationInner7.setName(\"7th Ring \" + ROIName)\nannotationInner7.setColorRGB(coloInner7Margin)\n\n\n\/\/ Get the 8th central area\ndef geomCentral8 = geomCentral7.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral8 = geomCentral8.intersection(geomCentral7)\ndef roiCentral8 = GeometryTools.geometryToROI(geomCentral8, plane)\ndef annotationCentral8 = PathObjects.createAnnotationObject(roiCentral8)\nannotationCentral8.setName(\"Third Inner Ring\")\nannotationCentral8.setColorRGB(colorCentral)\n\n\/\/ Get the 8th inner margin area\ndef geomInner7 = geomCentral7 \/\/ change from geomcentral8\ngeomInner7 = geomCentral7.difference(geomCentral8)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner7 = GeometryTools.geometryToROI(geomInner7, plane)\ndef annotationInner8 = PathObjects.createAnnotationObject(roiInner7)\nannotationInner8.setName(\"8th Ring \" + ROIName)\nannotationInner8.setColorRGB(coloInner8Margin)\n\n\n\/\/ Get the 9th central area\ndef geomCentral9 = geomCentral8.buffer(expandPixels) \/\/ geomCentral.buffer(expandPixels)\ngeomCentral9 = geomCentral9.intersection(geomCentral8)\ndef roiCentral9 = GeometryTools.geometryToROI(geomCentral9, plane)\ndef annotationCentral9 = PathObjects.createAnnotationObject(roiCentral9)\nannotationCentral9.setName(\"Central Ring \" + ROIName)\nannotationCentral9.setColorRGB(colorCentral)\n\n\/\/ Get the 9th inner margin area\ndef geomInner8 = geomCentral8\/\/ change from geomcentral9\ngeomInner8 = geomCentral8.difference(geomCentral9)\n\/\/geomInner1 = geomInner.intersection(areaTissue)\ndef roiInner8 = GeometryTools.geometryToROI(geomInner8, plane)\ndef annotationInner9 = PathObjects.createAnnotationObject(roiInner8)\nannotationInner9.setName(\"9th Ring \" + ROIName)\nannotationInner9.setColorRGB(coloInner9Margin)\n\n\n\n\n\n\n\/\/ Add the annotations, added annotationInner6 to 250\nhierarchy.getSelectionModel().clearSelection()\nhierarchy.removeObject(selected, true)\ndef annotationsToAdd = [annotationInner, annotationInner2, annotationInner3, annotationInner4,annotationInner5, annotationInner6, annotationInner7, annotationInner8, annotationInner9,  annotationCentral9];\nannotationsToAdd.each {it.setLocked(lockAnnotations)}\nhierarchy.addPathObjects(annotationsToAdd)","command_name":"Concentrical Partition Script","command":"Script modified from tumor region annotations script written by Pete Bankhead to capture liver lobule rings.","os_name":null,"os_version":null}},{"id":1054730,"guid":"D8C6AB60820811EB8EB3FDE5E8BF38F7","order_id":7,"type_id":15,"title":"command","source":{"id":8659,"name":"\/\/Set to false to restore test data for the entire project.\n\/\/True allows you to restore the data temporarily to the current image; you may then change images without saving or Reload to remove it quickly.\n\/\/Should be Run, ***NOT Run for Project.***\ncurrentImageOnly = true\n\nproject=getProject()\ncurrent = getProjectEntry().getImageName()\nproject.getImageList().each{\n    if (currentImageOnly && it.getImageName() == current){\n\n        String imgName = it.getImageName()\n        hierarchy = getCurrentHierarchy()\n\n        createCurrentTrainingAreas(hierarchy, imgName)\n        fireHierarchyUpdate()\n        \n    }else if(!currentImageOnly){\n        print \"CHANGES WILL NOT SHOW UP IN CURRENT IMAGE UNTIL YOU File->Reload data or change image\"\n        String imgName = it.getImageName()\n        imageData = it.readImageData()\n        hierarchy = imageData.getHierarchy()\n        \n        createTrainingAreas(hierarchy, imgName)\n        it.saveImageData(imageData)\n    }\n}\n\ndef createTrainingAreas(hierarchy, imgName){\n    def gson = GsonTools.getInstance(true);\n    def type = new com.google.gson.reflect.TypeToken<List<qupath.lib.objects.PathObject>>() {}.getType();\n    \n    path = buildFilePath(PROJECT_BASE_DIR, 'testSetPoints')\n    def json = new File(buildFilePath(PROJECT_BASE_DIR, 'testSetPoints', imgName + \".testarea\"))\n    deserializedAnnotations = gson.fromJson(json.getText('UTF-8'), type);\n    hierarchy.addPathObjects(deserializedAnnotations)\n    }\n\n\ndef createCurrentTrainingAreas(hierarchy, imgName){\n    def gson = GsonTools.getInstance(true);\n    def type = new com.google.gson.reflect.TypeToken<List<qupath.lib.objects.PathObject>>() {}.getType();\n    \n    path = buildFilePath(PROJECT_BASE_DIR, 'testSetPoints')\n    def json = new File(buildFilePath(PROJECT_BASE_DIR, 'testSetPoints', imgName + \".testarea\"))\n    deserializedAnnotations = gson.fromJson(json.getText('UTF-8'), type);\n    addObjects(deserializedAnnotations)\n    }","command_name":"Restore Annotation Script","command":"Script to restore saved \"Other\" lobule annotations.","os_name":null,"os_version":null}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#50e3c2","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1142218,"guid":"1E080CE0820A11EB8EB3FDE5E8BF38F7","previous_id":1141358,"previous_guid":"34E7D8C0816D11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"3CB6BD24DCBA4B1B90F58F01ACA27CFF","order_id":1,"type_id":6,"title":"Section","source":{"title":"Analysis Optimization"}},{"id":1054724,"guid":"CF2693F80A40477EA610D145CD5ED530","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Once parameters are established, save optimized positive cell detection script to project folder for future access and batch processing.<\/div><br\/><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"64E4D07F443F476185178320B9826186","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Video instructions available at <\/span><a href=\"https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">https:\/\/www.dropbox.com\/sh\/9jlpijg9bburnnc\/AACyg2ntSZbFhIYnUIYI37DOa?dl=0<\/span><\/a><\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#f5a623","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1176587,"guid":"D66486D0B28C11EB9164D7F78321ADCE","previous_id":1192297,"previous_guid":"4DC059A0C79811EB8632FB15182ECF35","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"8204C5371FC64A4D9D2EA260ED0A359B","order_id":1,"type_id":6,"title":"Section","source":{"title":"Spatial Lobular Analysis"}},{"id":1054724,"guid":"5884A3BCFBCB4A2489C4BC0C2DB24D1E","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">For rectangular locational analysis of periportal versus pericentral immune cells, locate portal tract and central vein regions and annotate using the rectangle annotation tool between the regions. Select annotated rectangle and partition using partitioning script below. <\/div><br\/><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7yjbizwf.jpg\" \/><\/div><br\/><br\/><br\/><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"D10FC56CD38B44EEA60CFB040A6C76A0","order_id":2,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/d7yjbizwf.jpg\" \/><\/div>"}},{"id":1054726,"guid":"CE6F52571DB74811A94B22ACA6D48FE6","order_id":3,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">Rectangle vs concentrical division:<\/div><br\/><div class = \"text-block\">Rectangle- In certain disease states, it is difficult to identify all portal tract regions and central vein for a complete liver lobule annotation. In addition, the central vein does not always land directly in the middle of the annotated lobule. In these cases, choosing to analyze the portal tract-central vein axis by rectangular division is ideal to accurately identify positive cells.<\/div><br\/><div class = \"text-block\">Concentrical- In the case of liver biopsy tissue or samples with limited area for analysis, it may be difficult to identify adjacent portal tract and central vein regions for rectangular analysis. In this case, analysis by concentrical divisions radiating from either the portal tract or central vein can assist in providing spatial information.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054727,"guid":"76618C271163454ABE3642B64217DDA4","order_id":4,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">Rectangle annotations can be saved using the Save Annotation Script in step 15 below. <\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054728,"guid":"84914D60B28D11EB9164D7F78321ADCE","order_id":5,"type_id":15,"title":"command","source":{"id":8791,"name":"\/**\n * Split a rectangle into equal parts along its longest dimension.\n * Rotated rectangles are supported.\n * \n * Written for https:\/\/forum.image.sc\/t\/how-to-divide-annotation-roi-into-equal-dimension-bins\/51563\/8\n *\n * @author Pete Bankhead\n * Taken from https:\/\/gist.github.com\/petebankhead\/e177b07784460a76d70f89347edd988d\n *\/\n\n\/\/ Number of regions to create\nint nRegions = 10\n\n\/\/ Get selected object\ndef selected = getSelectedObject()\nif (selected == null) {\n    println 'No object selected!'\n}\n\n\/\/ Get points, removing duplicates\ndef roi = selected.getROI()\ndef points = new LinkedHashSet<>(roi.getAllPoints()) as List\nif (points.size() != 4) {\n    println 'I need a ROI with exactly 4 points'\n    return\n}\n\n\/\/ Get the side lengths\ndouble d1 = points[1].distance(points[0])\ndouble d2 = points[2].distance(points[1])\ndouble d3 = points[3].distance(points[2])\ndouble d4 = points[0].distance(points[3])\n\n\/\/ Check we really have a rectangle\n\/\/ (Set this to a higher number of it's too strict)\ndouble eps = 0.01\nif (Math.abs(d1 - d3) > eps || Math.abs(d4 - d2) > eps) {\n    println 'Points do not appear to form a rectangle!'\n    return\n}\n\n\/\/ Get starting point based on longest side\nint ind = 0\nif (d1 > d2) {\n    points.add(0, points.remove(3))\n}\ndouble x = points[ind].x\ndouble y = points[ind].y\ndouble dx = (points[ind+1].x - x) \/ nRegions\ndouble dy = (points[ind+1].y - y) \/ nRegions\ndouble dx2 = (points[ind+2].x - points[ind+1].x)\ndouble dy2 = (points[ind+2].y - points[ind+1].y)\n\n\/\/ Add annotations\ndef annotations = []\nfor (int i = 0; i < nRegions; i++) {\n    double originX = x + dx*i\n    double originY = y + dy*i\n    def polygon = ROIs.createPolygonROI(\n        [originX, originX+dx, originX+dx+dx2, originX+dx2] as double[],\n        [originY, originY+dy, originY+dy+dy2, originY+dy2] as double[],\n        roi.getImagePlane()\n    )\n    def newAnnotation = PathObjects.createAnnotationObject(polygon)\n    newAnnotation.setName(\"ROI 1 Layer ${i+1}\") \/\/To change ROI number \n    annotations << newAnnotation\n}\n\naddObjects(annotations)","command_name":"Rectangle Partition Script","command":null,"os_name":null,"os_version":null}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#50e3c2","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1192277,"guid":"38F93F60C79711EB8632FB15182ECF35","previous_id":1141356,"previous_guid":"A73BD760816C11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"E62B53E026194E3690BF30B5A60970C0","order_id":1,"type_id":6,"title":"Section","source":{"title":"Image Annotation"}},{"id":1054724,"guid":"00A3211D7CB44421B90DB9E5CEC14F04","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Annotate sub ROIs within overarching sample ROI with rectangle annotation tool for optimization of stain positivity detection parameters. <\/div><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"5D9DB05B14A840B68DB07A19FA6900F3","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">Optimizing on smaller sub ROIs will save processing time. Whole image processing (20X magnification) takes approximately 1 min while sub ROIs capturing the sinusoid take around 10-20 seconds.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}},{"id":1054726,"guid":"542DC933AB3D4D078B9CC80B247CC7BD","order_id":3,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">Attempt to capture varying ROIs (ROIs that depict varying degrees of background staining or ROIs that capture different portions of the liver sinusoid) to best ensure optimized parameters consistently detect across the entire sample.<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#4a90e2","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1192283,"guid":"01D33F30C79811EB8632FB15182ECF35","previous_id":1142218,"previous_guid":"1E080CE0820A11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"D23AF6EBE78C4FBFA90D9160A4F972BC","order_id":1,"type_id":6,"title":"Section","source":{"title":"Analysis Optimization"}},{"id":1054724,"guid":"1AAA5F01607643B9B2B80179B81BBF0E","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Delete all optimization detections.<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#f5a623","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1192292,"guid":"37A41A30C79811EB8632FB15182ECF35","previous_id":1176587,"previous_guid":"D66486D0B28C11EB9164D7F78321ADCE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"CFDC7C9A44774A239288B3536173936B","order_id":1,"type_id":6,"title":"Section","source":{"title":"Spatial Lobular Analysis"}},{"id":1054724,"guid":"1133CF99404F43B6B86135C2C49367EB","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#9013fe","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1192297,"guid":"4DC059A0C79811EB8632FB15182ECF35","previous_id":1141359,"previous_guid":"56B34660816D11EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"DA9B85A178854F8BAC5C76784ACA7B80","order_id":1,"type_id":6,"title":"Section","source":{"title":"Run Analysis"}},{"id":1054724,"guid":"7B23A9629F3A430A927F83574E2E323E","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Save image detections.<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#9013fe","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1194593,"guid":"31D6A3C0CA4011EB92C3D3B3A44DE96F","previous_id":1194594,"previous_guid":"D7F816D0CA4011EB92C3D3B3A44DE96F","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"FA4166EFD54545039FC538BB049E4357","order_id":1,"type_id":6,"title":"Section","source":{"title":"Export Results"}},{"id":1054724,"guid":"5DAD490E559E4269B86190B419A90701","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Export detection results for all annotations (<\/span><span style = \"font-weight:bold;\">Export<\/span><span> > <\/span><span style = \"font-weight:bold;\">Export Measurements<\/span><span>). Export file types include .tsv and .csv files.<\/span><\/div><br\/><br\/><br\/><br\/><\/div>"}},{"id":1054725,"guid":"70D506762E0848E2A0333E9A92924786","order_id":2,"type_id":26,"title":"notes","source":{"id":0,"parent_id":0,"uri":"","title":"","body":"<div class = \"text-blocks\"><div class = \"text-block\">For annotation detection results of liver lobule locational analysis, select \"Annotations\" in \"Export Type\".<\/div><\/div>","created_on":0,"changed_on":0,"creator":{"name":"","affiliation":null,"affiliations":[],"username":"","note":null,"link":null,"image":{"source":"","placeholder":""},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"comments":[]}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#f8e71c","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1194594,"guid":"D7F816D0CA4011EB92C3D3B3A44DE96F","previous_id":1142215,"previous_guid":"AE334340820311EB8EB3FDE5E8BF38F7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"85F835E47E0A48FFBCD6D81D91FD0EF1","order_id":1,"type_id":6,"title":"Section","source":{"title":"Spatial Lobular Analysis"}},{"id":1054724,"guid":"A253FD1638654FB098F8DA464AE1F241","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Select all detections, insert detections into hierarchy and save to analyze positivity per partition<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#50e3c2","section_duration":0,"critical":null,"critical_id":null,"duration":0}],"document":"","materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\">Digital image analysis is a widely employed technique to effectively reduce sample processing time and bias. Whole slide imaging and analysis of immunohistochemically stained sample slides allows for rapid cellular quantification and insight into single cell and subcellular data that cannot be acquired by the naked eye. QuPath is an emerging open-source platform for digital pathology that provides as a free, flexible and highly accessible option to investigate histology and cellular infiltration. Despite the introduction of program modules that assist with quantification, research methodologies in the literature are inconsistent and impedes comparison across studies. This protocol offers validated, step-by-step instruction on how to optimize and run parameters using the QuPath Positive Cell Detection module, outlines how to quantitate and assess spatial distribution of cells in the liver lobule structure and presents tips and tricks to easily navigate the QuPath platform. The protocol will act to standardize optimization in QuPath for improved comparison in the literature and serve as a guide for new users. <\/div><\/div>","changed_on":1629129478}