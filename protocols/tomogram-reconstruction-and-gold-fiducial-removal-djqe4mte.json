{"access":{"can_view":true,"can_edit":false,"can_remove":false,"can_add":false,"can_publish":false,"can_get_doi":false,"can_share":true,"can_move":true,"can_move_outside":true,"can_transfer":true,"can_download":true,"limited_run":false,"limited_private_links":false,"limited_blind_links":false,"is_locked":false},"authors":[{"name":"Connor Garrels","affiliation":"Oregon Health \u0026 Science University","affiliation_url":null,"username":"connor-garrels","link":null,"user_image_file":{"guid":"00000000000000000000000000000001","file_name":"avatar.png","url":"https://www.protocols.io/img/avatars/001.png","mime":"image/png","size":0,"width":100,"height":100,"avg_color":"","scan_status":0,"created_at":0},"note":"","is_verified_user":true},{"name":"Benjamin Barad","affiliation":"Oregon Health \u0026 Science University","affiliation_url":null,"username":"benjamin-barad","link":"http://benjaminbarad.com","user_image_file":{"guid":"00000000000000000000000000000001","file_name":"avatar.png","url":"https://www.protocols.io/img/avatars/001.png","mime":"image/png","size":0,"width":100,"height":100,"avg_color":"","scan_status":0,"created_at":0},"note":"","is_verified_user":true},{"name":"Steve Reichow","affiliation":"Oregon Health \u0026 Science University","affiliation_url":null,"username":"","link":null,"user_image_file":{"guid":"00000000000000000000000000000001","file_name":"avatar.png","url":"https://www.protocols.io/img/avatars/001.png","mime":"image/png","size":0,"width":100,"height":100,"avg_color":"","scan_status":0,"created_at":0},"note":"","is_verified_user":false}],"before_start":"","book_chapter":null,"can_accept_authorship":false,"can_be_copied":true,"can_claim_authorship":false,"can_manage_keywords":true,"can_remove_fork":false,"can_sign":false,"child_steps":{},"cited_protocols":[],"collection_items":[],"created_on":1724098986,"creator":{"name":"Connor Garrels","affiliation":"Oregon Health \u0026 Science University","affiliation_url":null,"username":"connor-garrels","link":null,"user_image_file":{"guid":"00000000000000000000000000000001","file_name":"avatar.png","url":"https://www.protocols.io/img/avatars/001.png","mime":"image/png","size":0,"width":100,"height":100,"avg_color":"","scan_status":0,"created_at":0},"badges":[],"affiliations":[{"affiliation":"Oregon Health \u0026 Science University","url":null,"job_title":"Graduate Researcher","is_default":true}]},"cross_cloud_origin":null,"description":"{\"blocks\":[{\"key\":\"del3\",\"text\":\"While gold nanoparticle fiducials greatly improve tilt-series alignment in cryo-electron tomography data, they can cause artifacts during later image processing steps. We present a workflow for high-quality fiducial removal using fidder, an open-source python package. This protocol demonstrates how to flexibly incorporate fidder into tomogram reconstruction using Warp and Etomo.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{}}","disclaimer":"","document":"","documents":null,"doi":"dx.doi.org/10.17504/protocols.io.6qpvr8qbblmk/v1","doi_status":2,"ethics_statement":"","fork_id":null,"fork_info":null,"fork_info_status":"not_fork","forks":[],"funders":[],"groups":[],"guid":"5F9E3CD17D0D4566875171A832B79632","guidelines":"","has_references":true,"has_step_reagents":false,"has_versions":false,"id":105958,"image":{"source":"https://www.protocols.io/img/default_protocol.png","webp_source":null,"placeholder":"https://www.protocols.io/img/default_protocol.png","webp_placeholder":null},"image_attribution":"","in_trash":false,"is_bookmarked":false,"is_contact_suspended":false,"is_content_confidential":false,"is_content_warning":false,"is_doi_reserved":false,"is_in_pending_publishing":false,"is_in_transfer":false,"is_owner":true,"is_research":true,"is_retracted":false,"is_shared_directly":false,"is_subprotocol":null,"is_unlisted":false,"item_id":1287130,"journal":null,"journals":[],"keywords":"cryoET,tomography,image processing,python","last_modified":1725565160,"link":"","location":null,"manuscript_citation":"","materials":[],"materials_text":"","ownership_history":null,"parent_collections":[],"parent_protocols":[],"peer_reviewed":false,"protocol_references":"{\"blocks\":[{\"key\":\"9366j\",\"text\":\"Tegunov, D., Cramer, P. Real-time cryo-electron microscopy data preprocessing with Warp. Nat Methods 16, 1146–1152 (2019). https://doi.org/10.1038/s41592-019-0580-y\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":89,\"length\":11},{\"style\":\"bold\",\"offset\":101,\"length\":2}],\"entityRanges\":[],\"data\":{}},{\"key\":\"bp8nl\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"9jpck\",\"text\":\"Mastronarde DN, Held SR. Automated tilt series alignment and tomographic reconstruction in IMOD. J Struct Biol. 2017 Feb;197(2):102-113. doi: 10.1016/j.jsb.2016.07.011. Epub 2016 Jul 19. PMID: 27444392; PMCID: PMC5247408.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"8jco7\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"2rpq2\",\"text\":\"Kremer JR, Mastronarde DN, McIntosh JR. Computer visualization of three-dimensional image data using IMOD. J Struct Biol. 1996 Jan-Feb;116(1):71-6. doi: 10.1006/jsbi.1996.0013. PMID: 8742726.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{}}","public":true,"public_fork_note":"","published_on":1725565160,"references":[],"related_equipments":[],"related_materials":[],"reserved_doi":"","retraction_reason":null,"samples":{},"shared_access_id":321,"show_comparison":false,"sign_info":null,"space_access":{"can_view":false,"can_edit":false,"can_remove":false,"can_add":false,"can_publish":true,"can_get_doi":true,"can_share":false,"can_move":false,"can_move_outside":false,"can_transfer":false,"can_download":false,"limited_run":false,"limited_private_links":false,"limited_blind_links":false,"is_locked":false},"space_id":130137,"state_version_id":3535,"stats":{"is_voted":false,"number_of_views":19,"number_of_steps":15,"number_of_bookmarks":0,"number_of_comments":0,"number_of_bookmarked_comments":0,"number_of_steps_comments":0,"number_of_protocol_comments":0,"number_of_exports":0,"number_of_runs":0,"number_of_votes":1,"number_of_reagents":0,"number_of_equipments":0,"number_of_collections":0,"number_of_forks":{"private":0,"public":0},"number_of_accessible_forks":0},"status":{"id":1,"info":"We use this protocol and it's working"},"steps":[{"id":2191483,"guid":"2AE409BD91314628A525377DE756DE1F","previous_id":2216653,"previous_guid":"ED7BF5D35AC940F0AABB3882E2A55BBA","section":"\u003cp\u003e\u003cstrong\u003eInstall Software\u003c/strong\u003e\u003c/p\u003e","section_color":"#94EBFF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"b4f4g\",\"text\":\"Make sure you have these packages installed.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"3kp14\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"7n7g\",\"text\":\"- IMOD\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":2,\"length\":4}],\"data\":{}},{\"key\":\"6gn30\",\"text\":\"- Warp (technically WarpTools on linux)\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":2,\"length\":4}],\"data\":{}},{\"key\":\"74lle\",\"text\":\"- Fidder\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":2,\"offset\":2,\"length\":6}],\"data\":{}},{\"key\":\"4u8cs\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"A8F7056657074C4888BF3A45D36F17C5\",\"url\":\"https://bio3d.colorado.edu/imod/\"}},\"1\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"578955CEB0774ADF939D982488F64D7F\",\"url\":\"https://warpem.github.io/warp/user_guide/warptools/installation/\"}},\"2\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"4362039273DF48D5A274EC630E10674F\",\"url\":\"https://github.com/teamtomo/fidder?tab=readme-ov-file\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"2","cases":[],"critical":null},{"id":2191500,"guid":"44CAA4ADD01048B39D67B44426F89A49","previous_id":2191483,"previous_guid":"2AE409BD91314628A525377DE756DE1F","section":"\u003cp\u003e\u003cstrong\u003eWarp Preprocessing\u003c/strong\u003e\u003c/p\u003e","section_color":"#84CE84","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"epqqt\",\"text\":\"We will be using Warp for the bulk of our processing. This section follows this warp tutorial. \",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":75,\"length\":18}],\"data\":{}},{\"key\":\"7u1ae\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"9rmpp\",\"text\":\"Values shown are data-specific (i.e. exposure, pixel size, paths), so please be careful when copying these commands. These are just example values!\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"F389C222E5DB40349C6676D724159000\",\"url\":\"https://warpem.github.io/warp/user_guide/warptools/quick_start_warptools_tilt_series/\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3","cases":[],"critical":null},{"id":2191501,"guid":"6E66DFEB1907406C9FE4B0614965F6B2","previous_id":2191500,"previous_guid":"44CAA4ADD01048B39D67B44426F89A49","section":"\u003cp\u003e\u003cstrong\u003eWarp Preprocessing\u003c/strong\u003e\u003c/p\u003e","section_color":"#84CE84","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"ca1gp\",\"text\":\"Create Settings Files\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":21}],\"entityRanges\":[],\"data\":{}},{\"key\":\"dp6t2\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"4ce7j\",\"text\":\"frameseries\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"7plcu\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"68s1f\",\"text\":\"tiltseries\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"2h8go\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"5o1f8\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"1etm0\",\"text\":\"If your data was collected at super-resolution like ours was, --bin 1 is very important!\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"9kud6\",\"text\":\"WarpTools create_settings --folder_data /where/your/movies/are --folder_processing frameseries --output frameseries.settings --extension *.tif --angpix 0.8125 --bin 1 --gain_path /where/your/gain/is --exposure 3\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"29A8DE62792E4E64A4D48D8339C56E9D\"}},\"1\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"fq6d8\",\"text\":\"WarpTools create_settings --output tiltseries.settings --folder_processing tiltseries --folder_data tomostar --extension *.tomostar --angpix 0.8125 --bin 1 --gain_path /where/your/gain/is --exposure 3 --tomo_dimensions 9600x12000x2500\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"2E7681C49AB0498E9B8355F951664AA1\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3.1","cases":[],"critical":null},{"id":2191509,"guid":"074BE36E8ACB4230B5F46ABA362F9773","previous_id":2191501,"previous_guid":"6E66DFEB1907406C9FE4B0614965F6B2","section":"\u003cp\u003e\u003cstrong\u003eWarp Preprocessing\u003c/strong\u003e\u003c/p\u003e","section_color":"#84CE84","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"6u02s\",\"text\":\"Motion Correction and CTF Estimation\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":36}],\"entityRanges\":[],\"data\":{}},{\"key\":\"8jibt\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"b0l\",\"text\":\"Motion correct and CTF estimate your data and output whole frame averages as well as even and odd frame-split micrographs for later denoising.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"e7ed7\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"2q87h\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"749q2\",\"text\":\"WarpTools fs_motion_and_ctf --settings frameseries.settings --m_grid 8x6x10 --c_grid 2x2x1 --c_range_max 7 --c_defocus_max 8 --c_use_sum --out_averages --out_average_halves\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"91E581FD9ED442849F72AF2FB1546DAA\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3.2","cases":[],"critical":null},{"id":2191510,"guid":"910BBFF03E2C4A32954334DA7B892FF6","previous_id":2191509,"previous_guid":"074BE36E8ACB4230B5F46ABA362F9773","section":"\u003cp\u003e\u003cstrong\u003eWarp Preprocessing\u003c/strong\u003e\u003c/p\u003e","section_color":"#84CE84","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"ca64f\",\"text\":\"Import tiltseries metadata\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":26}],\"entityRanges\":[],\"data\":{}},{\"key\":\"8vf4b\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"89bfd\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"ajnqg\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"f43en\",\"text\":\"You may need to edit your mdocs to reflect where your motion corrected micrographs are. If so, try this script.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"cvr86\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"1if3l\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"5hbkg\",\"text\":\"WarpTools ts_import --mdocs /where/your/mdocs/are --frameseries frameseries --tilt_exposure 3 --min_intensity 0.3 --dont_invert --output tomostar\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"8D73AB0F5D424E29ABFF06A8F65818B6\"}},\"1\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"3p8bc\",\"text\":\"#!/usr/bin/env python3\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"1dqdu\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"f9a96\",\"text\":\"import os\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"da0m1\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"88grt\",\"text\":\"mdoc_folder = '/where/your/mdocs/are'\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"f0jp8\",\"text\":\"new_subframe_path = 'where/your/micrographs/are'\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"97tpq\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"6i44n\",\"text\":\"def update_subframe_path(mdoc_path, new_path):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"ap969\",\"text\":\"    with open(mdoc_path, 'r') as f:\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"a8ugg\",\"text\":\"        lines = f.readlines()\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"83eqj\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"f4kgt\",\"text\":\"    for i, line in enumerate(lines):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"ajurb\",\"text\":\"        if line.startswith('SubFramePath'):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"9f6iv\",\"text\":\"            existing_path = line.split('=')[-1].strip().replace('\\\\\\\\', '/')\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"26s1m\",\"text\":\"            _, existing_filename = os.path.split(existing_path)\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"7fo4r\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"89oqr\",\"text\":\"            new_subframe_path = f'SubFramePath = {os.path.join(new_path, existing_filename)}\\\\n'\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"419m7\",\"text\":\"            lines[i] = new_subframe_path\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"37pnp\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"1p918\",\"text\":\"    with open(mdoc_path, 'w') as f:\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"43nue\",\"text\":\"        f.writelines(lines)\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"d6hdt\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"f4c0u\",\"text\":\"def batch_update_paths(folder_path, new_path):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"ek7ln\",\"text\":\"    for filename in os.listdir(folder_path):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"cpe4d\",\"text\":\"        if filename.endswith('.mdoc'):\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"a99g3\",\"text\":\"            mdoc_path = os.path.join(folder_path, filename)\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"35doq\",\"text\":\"            update_subframe_path(mdoc_path, new_path)\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"fvuom\",\"text\":\"            print(f'SubFramePath updated for {filename}')\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"4n704\",\"text\":\"\",\"type\":\"unstyled\"},{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"6kpjp\",\"text\":\"batch_update_paths(mdoc_folder, new_subframe_path)\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"ED79AB451E2D4F2BA37DDC20DA43F173\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3.3","cases":[],"critical":null},{"id":2191515,"guid":"5F2D841DD21D4CE1949A2205C0311D9A","previous_id":2191510,"previous_guid":"910BBFF03E2C4A32954334DA7B892FF6","section":"\u003cp\u003e\u003cstrong\u003eWarp Preprocessing\u003c/strong\u003e\u003c/p\u003e","section_color":"#84CE84","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"7hglo\",\"text\":\"Make Stacks\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":11}],\"entityRanges\":[],\"data\":{}},{\"key\":\"eo590\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"9gj73\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"3p16t\",\"text\":\"Notice we chose to make our stacks at 6.5 Å (bin 4 from physical pixel size). Whatever size you choose, remember it, as it is the resolution you will use for alignment and reconstruction later.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"9nlik\",\"text\":\"WarpTools ts_stack --settings tiltseries.settings --angpix 6.5\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"F16A5089EFCD4FA79E4F728FEABF2D48\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3.4","cases":[],"critical":null},{"id":2191519,"guid":"AF39732762CE48A68A2AFB454EA69D3C","previous_id":2191515,"previous_guid":"5F2D841DD21D4CE1949A2205C0311D9A","section":"\u003cp\u003e\u003cstrong\u003eEtomo tilt series alignment\u003c/strong\u003e\u003c/p\u003e","section_color":"#FFED92","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"dr84g\",\"text\":\"We will use batch processing in etomo for aligning our newly created stacks. Components of this section follows this warp tutorial.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":112,\"length\":19}],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"60E8D78D394246FB95AB75031C517DC7\",\"url\":\"https://warpem.github.io/warp/reference/warptools/custom_tilt_series_alignments/#import-alignments\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"4","cases":[],"critical":null},{"id":2191522,"guid":"30BB37209ECF4844BD56AFBF3D04C68C","previous_id":2191519,"previous_guid":"AF39732762CE48A68A2AFB454EA69D3C","section":"\u003cp\u003e\u003cstrong\u003eEtomo tilt series alignment\u003c/strong\u003e\u003c/p\u003e","section_color":"#FFED92","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"be4k7\",\"text\":\"Make etomo directory\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":20}],\"entityRanges\":[],\"data\":{}},{\"key\":\"74pna\",\"text\":\"Create the directory 'etomo' in your /tiltseries directory.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"4.1","cases":[],"critical":null},{"id":2191523,"guid":"24A0EDCC311E437BBF9E54349F1A6A5C","previous_id":2191522,"previous_guid":"30BB37209ECF4844BD56AFBF3D04C68C","section":"\u003cp\u003e\u003cstrong\u003eEtomo tilt series alignment\u003c/strong\u003e\u003c/p\u003e","section_color":"#FFED92","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"54jqh\",\"text\":\"etomo\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":5}],\"entityRanges\":[],\"data\":{}},{\"key\":\"8g6nm\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"68td5\",\"text\":\"Open etomo in your /tilseries/etomo directory and choose the 'Batch Processing' button.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"9sedq\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"1vnin\",\"text\":\"Set up your etomo session thusly:\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"db238\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"8rv18\",\"text\":\"Batch Setup Tab\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"a2gf9\",\"text\":\"Select 'Move all stacks to dataset directory under:' and enter the path to your /tiltseries/etomo directory\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"a5adb\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"d9737\",\"text\":\"Stacks Tab\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"9ggjt\",\"text\":\"Add the stacks made in the last Warp step. The stacks will be .st files.\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bburv\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bgjh\",\"text\":\"Dataset Values (Basic Tab)\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"cqo8t\",\"text\":\"Set fiducial bead size in nm (my BSA-coated 5nm gold beads are closer to 8nm)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"7u59t\",\"text\":\"'Coarse aligned stack binning - single frame' should be 1 (no binning)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":56,\"length\":1}],\"entityRanges\":[],\"data\":{}},{\"key\":\"940re\",\"text\":\"'Aligned stack binning' should be 1 (no binning)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":34,\"length\":1}],\"entityRanges\":[],\"data\":{}},{\"key\":\"79o49\",\"text\":\"Select 'R-weighted back projection' and deselect 'SIRT-like filter'\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"5v09u\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"f76tb\",\"text\":\"Dataset Values (Advanced Tab)\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"3mv64\",\"text\":\"Set 'Tilt Axis Rotation' (mine was 85)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"8iql\",\"text\":\"'Use existing .rawtlt file for A/only axis:' should be set to Yes. (IMPORTANT)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":62,\"length\":16},{\"style\":\"bold\",\"offset\":67,\"length\":11}],\"entityRanges\":[],\"data\":{}},{\"key\":\"5ps1o\",\"text\":\"'Type of magnification solution' should be 0: fixed\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":43,\"length\":8}],\"entityRanges\":[],\"data\":{}},{\"key\":\"4e6bm\",\"text\":\"'Type of rotation solution' should be 5: grouped\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":38,\"length\":10}],\"entityRanges\":[],\"data\":{}},{\"key\":\"eq9o3\",\"text\":\"'Type of beam tilt solution' should be -1: solve one\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":39,\"length\":13}],\"entityRanges\":[],\"data\":{}},{\"key\":\"5mte2\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"arl04\",\"text\":\"Run Tab\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"auijb\",\"text\":\"Create the file /usr/local/ImodCalib/cpu.adoc per these instructions.\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":46,\"length\":22}],\"data\":{}},{\"key\":\"2kdlm\",\"text\":\"  \",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"393qs\",\"text\":\"'number' is the number of logical cpu cores on your machine. 'gpu.device' is the list of GPUs on your machine (note the list starts at 1, unlike CUDA device nomenclature).\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"6c5f7\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bg7t6\",\"text\":\"With the .adoc created, select your desired # CPUs value (I chose 56).\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":44,\"length\":7}],\"entityRanges\":[],\"data\":{}},{\"key\":\"70sjm\",\"text\":\"Select 'Parallel GPUs' and set your # GPUs value (I chose 2)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":36,\"length\":7}],\"entityRanges\":[],\"data\":{}},{\"key\":\"55m66\",\"text\":\"Select 'Run multiple batch jobs in parallel' if you dare. I was able to run 7 jobs with a maximum of 2 GPUs per job. \",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bs8q6\",\"text\":\"Under 'Subset of Steps to Run', check Stop after  and select Fine alignment. (IMPORTANT)\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":38,\"length\":11},{\"style\":\"italic\",\"offset\":61,\"length\":16},{\"style\":\"italic\",\"offset\":78,\"length\":10},{\"style\":\"bold\",\"offset\":77,\"length\":11}],\"entityRanges\":[],\"data\":{}},{\"key\":\"kt6r\",\"text\":\"Click Run  and rock and roll\",\"type\":\"unordered-list-item\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"italic\",\"offset\":6,\"length\":4}],\"entityRanges\":[],\"data\":{}},{\"key\":\"3pu4q\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"34jka\",\"text\":\"This will output two alignments files for each tiltseries - .xf and .tlt. \",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bto4o\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"5B3B522917014C7CB3A7916446466200\",\"url\":\"https://bio3d.colorado.edu/imod/doc/man/cpuadoc.html\"}},\"1\":{\"type\":\"file\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"\",\"id\":497098,\"original_name\":\"cpu.adoc\",\"placeholder\":\"https://www.protocols.io/img/extensions/file.png\",\"raw_source\":\"\",\"size\":64,\"source\":\"https://protocols-files.s3.amazonaws.com/files/rfqkcgtx7.adoc?X-Amz-Algorithm=AWS4-HMAC-SHA256\\u0026X-Amz-Credential=AKIAJYFAX46LHRVQMGOA%2F20240905%2Fus-east-1%2Fs3%2Faws4_request\\u0026X-Amz-Date=20240905T200103Z\\u0026X-Amz-Expires=604800\\u0026X-Amz-SignedHeaders=host\\u0026X-Amz-Signature=702c3b34d8d426c5986da60e7e5c94ebe0348591ba0aae181518a52417f7be9b\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"4.2","cases":[],"critical":null},{"id":2191544,"guid":"FD4D09FF229C41838BE67390F11F8794","previous_id":2191523,"previous_guid":"24A0EDCC311E437BBF9E54349F1A6A5C","section":"\u003cp\u003e\u003cstrong\u003eWarp\u003c/strong\u003e\u003c/p\u003e","section_color":"#EA9F6C","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"jkp7\",\"text\":\"Head back to warp to import the etomo alignments and get ready for reconstruction. Still following this guide.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":99,\"length\":11}],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"FC49019BB5B843D2AA354527DCBA9C20\",\"url\":\"https://warpem.github.io/warp/reference/warptools/custom_tilt_series_alignments/#import-alignments\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"5","cases":[],"critical":null},{"id":2191545,"guid":"227E884397C54D638FDA75AB7C94DD6D","previous_id":2191544,"previous_guid":"FD4D09FF229C41838BE67390F11F8794","section":"\u003cp\u003e\u003cstrong\u003eWarp\u003c/strong\u003e\u003c/p\u003e","section_color":"#EA9F6C","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"6rm19\",\"text\":\"Import alignments\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":17}],\"entityRanges\":[],\"data\":{}},{\"key\":\"n5d8\",\"text\":\"Copy the .xf and .tlt files from their etomo subdirectories and move to their own folder at tiltseries/imod_xf_tlt.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"62c0v\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"44u79\",\"text\":\"Then run\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"82fk9\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"agbr1\",\"text\":\"Remember we made our stacks at 6.5Å in step 2.4 and did no binning in etomo, so the alignments were all calculated at 6.5Å.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"asdk4\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"4n0ba\",\"text\":\"WarpTools ts_import_alignments --settings tiltseries.settings --alignments tiltseries/imod_xf_tlt --alignment_angpix 6.5\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"7815BAB1FFF84A739554C3584995CAD0\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"5.1","cases":[],"critical":null},{"id":2191603,"guid":"E0B95D947A164A0F9E93EFBC1B7986A8","previous_id":2191545,"previous_guid":"227E884397C54D638FDA75AB7C94DD6D","section":"\u003cp\u003e\u003cstrong\u003eWarp\u003c/strong\u003e\u003c/p\u003e","section_color":"#EA9F6C","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"901le\",\"text\":\"Check Handedness\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":16}],\"entityRanges\":[],\"data\":{}},{\"key\":\"6pc0r\",\"text\":\"Back to this tutorial.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":8,\"length\":13}],\"data\":{}},{\"key\":\"6ku2m\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"2hov4\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"fqlac\",\"text\":\"Follow the instructions in the output of this job to change your handedness if necessary.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"80A8B08BA54A4DA092C8CCEC803C8F60\",\"url\":\"https://warpem.github.io/warp/user_guide/warptools/quick_start_warptools_tilt_series/#tilt-series-import\"}},\"1\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"dedls\",\"text\":\"WarpTools ts_defocus_hand --settings tiltseries.settings --check\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"B5AAF782F0984F769F36B6E3BAAF58D1\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"5.2","cases":[],"critical":null},{"id":2191711,"guid":"11A1A6467D0041FEADFA25C9BF937AB0","previous_id":2191603,"previous_guid":"E0B95D947A164A0F9E93EFBC1B7986A8","section":"\u003cp\u003e\u003cstrong\u003eFidder\u003c/strong\u003e\u003c/p\u003e","section_color":"#E57785","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"ctcl\",\"text\":\"Fidder - involves two steps; creating masks of fiducials and erasing them. We have provided an example python script to complete both steps on your full and half micrographs so long as they are within the warp file structure. There is also the option to use the command-line for fidder. \",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":6}],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"link\",\"mutability\":\"MUTABLE\",\"data\":{\"guid\":\"E361D68190AC4F168D75CFFC6B790126\",\"url\":\"https://github.com/teamtomo/fidder\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"6","cases":[],"critical":null},{"id":2193216,"guid":"3F837C3A2EF74992899B4B7CAAA99359","previous_id":2191711,"previous_guid":"11A1A6467D0041FEADFA25C9BF937AB0","section":"\u003cp\u003e\u003cstrong\u003eFidder\u003c/strong\u003e\u003c/p\u003e","section_color":"#E57785","section_duration":0,"is_substep":true,"step":"{\"blocks\":[{\"key\":\"9ael\",\"text\":\"You should only have to edit the parent_dir variable.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"fs0bg\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"4cn92\",\"text\":\"Depending on your computational resources, you may want to change the Pool() variable. erase_gold runs well with Pool(48) on our 64-thread machine.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"bhki1\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"7vl12\",\"text\":\"Rename your existing (gold-containing) micrograph directories so they are not recognized by warp (e.g. /averages becomes /averages_gold etc.)\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"8elk0\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"ajleo\",\"text\":\"Move your newly gold-erased micrographs to the directories you just renamed (e.g. /frameseries/average, /frameseries/average/even, frameseries/average/odd)\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"882su\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"dlic0\",\"text\":\"To reconstruct your beautiful gold-erased tomograms:\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"ahd48\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":1,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"drktf\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"1jq47\",\"text\":\"#!/usr/bin/env python3\\n\\nimport os\\nfrom multiprocessing import Pool\\nimport mrcfile\\nimport torch\\nfrom fidder.predict import predict_fiducial_mask\\nfrom fidder.erase import erase_masked_region\\n\\nparent_dir = '/path/to/you/warp/frameseries/'\\n\\ndef check_directories(parent_dir):\\n    for subdir in subdirs:\\n        dir_path = os.path.join(parent_dir, subdir)\\n        if os.path.exists(dir_path):\\n            print(dir_path + ' found.')\\n        if not os.path.exists(dir_path):\\n            os.makedirs(dir_path)\\n            print(dir_path + ' created.')\\n\\n    os.makedirs(os.path.join(parent_dir, 'average_erased'), exist_ok=True)\\n    os.makedirs(os.path.join(parent_dir, 'average', 'even_erased'), exist_ok=True)\\n    os.makedirs(os.path.join(parent_dir, 'average', 'odd_erased'), exist_ok=True)\\n\\n    \\n\\ndef make_mask(filename, parent_dir):\\n    \\\"\\\"\\\" Apply fidder's predict_fidcucial_mask function to a single micrograph and save the resultant mask as a new mrc file.\\n\\n    Args:\\n        filename (str) : The name of the micrograph to process.\\n        parent_dir (str) : The directory containing micrographs in /average and frame-split halves in \\n            /average/even, and /average/odd subdirectories.\\n    \\\"\\\"\\\"\\n    mic_path = os.path.join(parent_dir, 'average', filename)\\n    mask_path = os.path.join(parent_dir, 'average', 'mask', filename)\\n\\n    image = torch.tensor(mrcfile.read(mic_path))\\n\\n    mask, probabilities = predict_fiducial_mask(\\n        image, pixel_spacing=1.35, probability_threshold=0.7\\n    )\\n\\n    mask_uint8 = mask.to(torch.uint8)\\n\\n    os.makedirs(os.path.dirname(mask_path), exist_ok=True)\\n\\n    with mrcfile.new(mask_path, overwrite=True) as mrc:\\n        mrc.set_data(mask_uint8.numpy())\\n\\n    print(mask_path + '/' + filename + ' mask made.')\\n\\ndef erase_gold(filename, parent_dir, subdir):\\n    \\\"\\\"\\\"Apply fidder's erase_masked_region function to a single frame and save the result as a new mrc file.\\n        \\n    Args:\\n        filename (str): The name of the micrograph to process.\\n        parent_dir (str) : The directory containing micrographs in /average and frame-split halves in\\n            /average/even, and /average/odd subdirectories.\\n    \\\"\\\"\\\"\\n    mask_path = os.path.join(parent_dir, 'average', 'mask', filename)\\n    \\n    mic_path  = os.path.join(parent_dir, subdir, filename)\\n\\n    if subdir == 'average':\\n        output_subdir = os.path.join(parent_dir, 'average_erased')\\n    else:\\n        output_subdir = os.path.join(parent_dir, subdir + '_erased')\\n\\n    os.makedirs(output_subdir, exist_ok=True)\\n\\n    image = torch.tensor(mrcfile.read(mic_path))\\n    mask = torch.tensor(mrcfile.read(mask_path))\\n\\n    erased_image = erase_masked_region(image=image, mask=mask)\\n\\n    mrc_output_path = os.path.join(output_subdir, filename)\\n    with mrcfile.new(mrc_output_path, overwrite=True) as mrc:\\n        mrc.set_data(erased_image.numpy())\\n\\n    print(output_subdir +  '/' + filename + ' completed')\\n\\ndef process_gold(subdir, parent_dir):\\n    filenames = [i for i in os.listdir(os.path.join(parent_dir, subdir)) if i.endswith('.mrc')]\\n    with Pool(48) as p:\\n        p.starmap(erase_gold, [(filename, parent_dir, subdir) for filename in filenames])\\n    print('################################ all gold erased for ' + subdir + ' ################################')\\n\\n\\nsubdirs = ['average', 'average/even', 'average/odd']\\n\\ncheck_directories(parent_dir)\\n\\nfilenames = [i for i in os.listdir(os.path.join(parent_dir, 'average')) if i.endswith('.mrc')]\\nfor filename in filenames:\\n    mask_path = os.path.join(parent_dir, 'average','mask', filename)\\n    if not os.path.exists(mask_path):\\n        make_mask(filename, parent_dir)\\n    else:\\n        print(f'{filename} aleady exists')\\nprint('################################ mask processing complete ################################')\\n\\nfor subdir in subdirs:\\n    process_gold(subdir, parent_dir)\\n\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"A412E75501C440ADB02CF8B4B0BDED4B\"}},\"1\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"riq1\",\"text\":\"WarpTools ts_reconstruct --settings tiltseries.settings --dont_invert --halfmap_frames --angpix 10\",\"type\":\"unstyled\"}],\"entityMap\":{},\"guid\":\"860F4C4869AC46A1AB8C1709BD4C6A06\"}}}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"6.1","cases":[],"critical":null},{"id":2216653,"guid":"ED7BF5D35AC940F0AABB3882E2A55BBA","previous_id":0,"previous_guid":null,"section":"\u003cp\u003eOverview\u003c/p\u003e","section_color":"#A492FF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"3fsgl\",\"text\":\"Gold nanoparticle fiducials in cryoET can greatly improve tilt-series alignment and tomogram quality. They can also introduce detrimental artifacts in downstream processing steps such as denoising or membrane segmentation. While there are methods to remove gold beads from micrographs, these methods are not always high quality or easily integrated into existing workflows. \",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"qiau\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"1h987\",\"text\":\"Here, we describe a workflow using fitter as part of tomogram reconstruction with Warp and Etomo, incorporating a step for gold fiducial removal with Fidder. The resulting tomograms are high quality because of the ability to use gold during alignment, but with no visible gold artifacts remaining.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{}}","data":null,"protocol_id":105958,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"1","cases":[],"critical":null}],"template_id":0,"title":"Tomogram Reconstruction and Gold Fiducial Removal with Warp, Etomo, and Fidder","title_html":"Tomogram Reconstruction and Gold Fiducial Removal with Warp, Etomo, and Fidder","type_id":1,"units":[{"id":1,"type_id":3,"name":"µL","can_manage":0,"read_only":0},{"id":2,"type_id":3,"name":"mL","can_manage":0,"read_only":0},{"id":3,"type_id":3,"name":"L","can_manage":0,"read_only":0},{"id":4,"type_id":3,"name":"µg","can_manage":0,"read_only":0},{"id":5,"type_id":3,"name":"mg","can_manage":0,"read_only":0},{"id":6,"type_id":3,"name":"g","can_manage":0,"read_only":0},{"id":7,"type_id":3,"name":"kg","can_manage":0,"read_only":0},{"id":8,"type_id":3,"name":"ng","can_manage":0,"read_only":0},{"id":9,"type_id":3,"name":"Hz","can_manage":0,"read_only":0},{"id":10,"type_id":24,"name":"°C","can_manage":0,"read_only":0},{"id":11,"type_id":24,"name":"°К","can_manage":0,"read_only":0},{"id":12,"type_id":24,"name":"°F","can_manage":0,"read_only":0},{"id":13,"type_id":25,"name":"Mass Percent","can_manage":0,"read_only":0},{"id":14,"type_id":25,"name":"% volume","can_manage":0,"read_only":0},{"id":15,"type_id":25,"name":"Mass / % volume","can_manage":0,"read_only":0},{"id":16,"type_id":25,"name":"Parts per Million (PPM)","can_manage":0,"read_only":0},{"id":17,"type_id":25,"name":"Parts per Billion (PPB)","can_manage":0,"read_only":0},{"id":18,"type_id":25,"name":"Parts per Trillion (PPT)","can_manage":0,"read_only":0},{"id":19,"type_id":25,"name":"Mole Fraction","can_manage":0,"read_only":0},{"id":20,"type_id":25,"name":"Mole Percent","can_manage":0,"read_only":0},{"id":21,"type_id":25,"name":"Molarity (M)","can_manage":0,"read_only":1},{"id":22,"type_id":25,"name":"Molarity (M)","can_manage":0,"read_only":0},{"id":23,"type_id":25,"name":"Genome copies per ml","can_manage":0,"read_only":0},{"id":24,"type_id":3,"name":"μV","can_manage":0,"read_only":0},{"id":25,"type_id":3,"name":"ms","can_manage":0,"read_only":0},{"id":26,"type_id":3,"name":"pg","can_manage":0,"read_only":0},{"id":27,"type_id":25,"name":"Molarity dilutions","can_manage":0,"read_only":0},{"id":28,"type_id":25,"name":"millimolar (mM)","can_manage":0,"read_only":0},{"id":29,"type_id":25,"name":"micromolar (µM)","can_manage":0,"read_only":0},{"id":30,"type_id":25,"name":"nanomolar (nM)","can_manage":0,"read_only":0},{"id":31,"type_id":25,"name":"picomolar (pM)","can_manage":0,"read_only":0},{"id":32,"type_id":24,"name":"Room temperature","can_manage":0,"read_only":0},{"id":33,"type_id":30,"name":"rpm","can_manage":0,"read_only":0},{"id":34,"type_id":30,"name":"x g","can_manage":0,"read_only":0},{"id":165,"type_id":24,"name":"On ice","can_manage":0,"read_only":0},{"id":200,"type_id":32,"name":"cm","can_manage":0,"read_only":0},{"id":201,"type_id":32,"name":"mm","can_manage":0,"read_only":0},{"id":202,"type_id":32,"name":"µm","can_manage":0,"read_only":0},{"id":203,"type_id":32,"name":"nm","can_manage":0,"read_only":0},{"id":204,"type_id":25,"name":"mg/mL","can_manage":0,"read_only":0},{"id":205,"type_id":25,"name":"µg/µL","can_manage":0,"read_only":0},{"id":206,"type_id":25,"name":"% (v/v)","can_manage":0,"read_only":0},{"id":207,"type_id":3,"name":"V","can_manage":0,"read_only":0},{"id":1324,"type_id":30,"name":"rcf","can_manage":0,"read_only":0},{"id":1359,"type_id":35,"name":"Bar","can_manage":0,"read_only":0},{"id":1360,"type_id":35,"name":"Pa","can_manage":0,"read_only":0}],"uri":"tomogram-reconstruction-and-gold-fiducial-removal-djqe4mte","url":"https://www.protocols.io/view/tomogram-reconstruction-and-gold-fiducial-removal-djqe4mte","version_class":105958,"version_data":{"id":0,"code":"djqe4mte","version_class":105958,"parent_id":null,"parent_uri":null,"is_same_owner":false,"is_parent_public":false,"has_pending_merge_request":false,"has_approved_merge_request":false,"merge_request":null},"version_id":0,"version_uri":"tomogram-reconstruction-and-gold-fiducial-removal-6qpvr8qbblmk/v1","versions":[{"id":105958,"title":"Tomogram Reconstruction and Gold Fiducial Removal with Warp, Etomo, and Fidder","title_html":"Tomogram Reconstruction and Gold Fiducial Removal with Warp, Etomo, and Fidder","image":{"source":"https://www.protocols.io/img/default_protocol.png","webp_source":null,"placeholder":"https://www.protocols.io/img/default_protocol.png","webp_placeholder":null},"doi":"dx.doi.org/10.17504/protocols.io.6qpvr8qbblmk/v1","uri":"tomogram-reconstruction-and-gold-fiducial-removal-djqe4mte","published_on":1725565160,"modified_on":1725565160,"version_class":105958,"version_id":0,"version_code":"djqe4mte","version_uri":"tomogram-reconstruction-and-gold-fiducial-removal-6qpvr8qbblmk/v1","created_on":1724098986,"categories":null,"type_id":1,"creator":{"name":"Connor Garrels","affiliation":"Oregon Health \u0026 Science University","affiliation_url":null,"username":"connor-garrels","link":null,"user_image_file":{"guid":"00000000000000000000000000000001","file_name":"avatar.png","url":"https://www.protocols.io/img/avatars/001.png","mime":"image/png","size":0,"width":100,"height":100,"avg_color":"","scan_status":0,"created_at":0}},"stats":{"number_of_comments":0,"last_comment_time":0}}],"warning":""}