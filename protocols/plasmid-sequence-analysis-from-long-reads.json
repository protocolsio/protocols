{"id":52981,"title":"Plasmid Sequence Analysis from Long Reads","title_html":"<p>Plasmid Sequence Analysis from Long Reads<\/p>","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.bxyvppw6","doi_status":2,"uri":"plasmid-sequence-analysis-from-long-reads-bxyvppw6","type_id":1,"template_id":1,"published_on":1630713667,"parent_protocols":[],"parent_collections":[],"cited_protocols":[],"version_id":5,"version_data":{"id":5,"code":"bxyvppw6","parent_id":51550,"parent_uri":"plasmid-sequence-analysis-from-long-reads-bwj6pcre","has_pending_merge_request":0,"has_approved_merge_request":1},"created_on":1630713280,"modified_on":null,"categories":null,"public":1,"is_unlisted":0,"creator":{"name":" ","affiliation":null,"affiliations":[],"username":null,"note":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"has_versions":0,"link":"","total_collections":0,"number_of_steps":13,"authors":[{"name":"David Eccles","affiliation":"Malaghan Institute of Medical Research (NZ)","affiliations":[],"username":"david-eccles","note":null,"link":null,"image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/vi7jpt6.jpg"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false}],"versions":[],"groups":[{"id":269,"uri":"high-molecular-weight-dna-extraction-from-all-kingdoms","title":"High molecular weight DNA extraction from all kingdoms","image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/ftfb5nw.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/ftfb5nw.jpg"},"tech_support":{"email":"See@each.protocol","phone":null,"hide_contact":0,"use_email":0,"url":null},"is_member":1,"request":{"id":269,"uri":"high-molecular-weight-dna-extraction-from-all-kingdoms","title":"High molecular weight DNA extraction from all kingdoms","image":{"source":"https:\/\/s3.amazonaws.com\/pr-journal\/ftfb5nw.jpg","placeholder":"https:\/\/s3.amazonaws.com\/pr-journal\/ftfb5nw.jpg"},"tech_support":{"email":"See@each.protocol","phone":null,"hide_contact":0,"use_email":0,"url":null},"is_member":1,"description":null,"research_interests":null,"website":null,"location":null,"affiliation":null,"status":{"is_visible":true,"access_level":0},"stats":{"files":[],"total_members":0,"total_followers":0,"total_child_groups":0,"total_parent_groups":0,"has_collaborations":0},"user_status":{"is_member":true,"is_confirmed":true,"is_invited":false,"is_owner":false,"is_admin":false,"is_following":false},"join_link":null,"token":null,"owner":{"name":" ","affiliation":null,"affiliations":[],"username":null,"note":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"is_protocol_requested":0,"is_group_requested":0,"is_my":false,"is_request":false,"is_confirmed":1,"is_declined":0,"requester":{"name":" ","affiliation":null,"affiliation_url":null,"username":null,"link":null},"protocol":{"id":0,"title":"Plasmid Sequence Analysis from Long Reads","title_html":"Plasmid Sequence Analysis from Long Reads","image":{"source":null,"placeholder":null},"doi":null,"doi_status":0,"uri":"plasmid-sequence-analysis-from-long-reads-bxyvppw6","type_id":1,"template_id":0,"published_on":null,"stats":{"number_of_views":0,"number_of_steps":0,"number_of_bookmarks":0,"number_of_comments":0,"number_of_exports":0,"number_of_runs":0,"number_of_votes":0,"is_voted":0},"parent_protocols":[],"parent_collections":[],"cited_protocols":[]},"created_on":1630713667,"resolve_on":0,"resolved_user":{"name":" ","affiliation":null,"affiliations":[],"username":null,"note":null,"link":null,"image":{"source":null,"placeholder":null},"badges":[],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"shared":false}}],"is_owner":1,"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_claim_authorship":0,"can_accept_authorship":0,"can_be_copied":1,"can_remove_fork":1,"fork_id":null,"url":"https:\/\/www.protocols.io\/view\/plasmid-sequence-analysis-from-long-reads-bxyvppw6","forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"guid":"05022B6325C54047B74050D093A89E9C","state_version_id":21,"steps":[{"id":1245601,"guid":"C230DBB05E8B469B8B2DCC9F52FB75BE","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"1CA0642AB3534D248F4725C37403A5C8","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"185B9A0252A6450CAEFCC4C8FD351020","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Demultiplex reads as per protocol <\/div><div class = \"text-block\"><a href=\"https:\/\/dx.doi.org\/10.17504\/protocols.io.7vmhn46\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">Demultiplexing Nanopore reads with LAST<\/span><\/a><\/div><div class = \"text-block\">.<\/div><br\/><div class = \"text-block\">If this has been done, then the following command should produce output without errors:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">for bc in $(awk '{print $2}' barcode_counts.txt);<\/div><div class = \"text-block\">  do ls demultiplexed\/reads_${bc}.fq.gz;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><div class = \"text-block\">Example output:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">demultiplexed\/reads_BC02.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC03.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC04.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC05.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC07.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC09.fq.gz<\/div><\/div><\/code><\/pre><\/div><br\/><div class = \"text-block\">If the barcode_counts.txt file is missing, the output will look like this:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">awk: fatal: cannot open file `barcode_counts.txt' for reading (No such file or directory)<\/div><\/div><\/code><\/pre><\/div><br\/><div class = \"text-block\">If one or more of the barcode-demultiplexed files are missing, the output will look something like this:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">demultiplexed\/reads_BC02.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC03.fq.gz<\/div><div class = \"text-block\">demultiplexed\/reads_BC04.fq.gz<\/div><div class = \"text-block\">ls: cannot access 'demultiplexed\/reads_BC05.fq.gz': No such file or directory<\/div><div class = \"text-block\">ls: cannot access 'demultiplexed\/reads_BC07.fq.gz': No such file or directory<\/div><div class = \"text-block\">demultiplexed\/reads_BC09.fq.gz<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245602,"guid":"03CC80726EBF4C09BBCC08B18FCD8CCB","previous_id":1245601,"previous_guid":"C230DBB05E8B469B8B2DCC9F52FB75BE","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"AB194861DC7440A29589345E73F18D7B","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"D1176D4321FF4FABB7BF737383E21A84","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">If reads have been demultiplexed by MinKNOW, then the following approach should work to create the right input format:<\/div><br\/><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">mkdir demultiplexed;<\/div><div class = \"text-block\"># readlocation is the directory that contains barcode subdirectories<\/div><div class = \"text-block\">readLocation = \"..\/*\/fastq_pass\"; # or \"..\/*\/pass\" for Guppy<\/div><div class = \"text-block\">for x in $(ls ${readLocation}); do<\/div><div class = \"text-block\">  echo ${x};<\/div><div class = \"text-block\">  cat ${readLocation}\/${x}\/*.fastq | gzip > demultiplexed\/reads_${x}.fq.gz;<\/div><div class = \"text-block\">  echo \"1 ${x}\" >> barcode_counts.txt;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245603,"guid":"E37CAA7A91804236BAEFA07816349629","previous_id":1245602,"previous_guid":"03CC80726EBF4C09BBCC08B18FCD8CCB","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"C4717ECF2D1E434A85384929231E05A2","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"6553BB16DE634B7CAD3C2BC714E6979A","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Create a directory to store results files<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">mkdir results<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245604,"guid":"5D51F041C2FB45A8AF2FD7BF9490D92F","previous_id":1245603,"previous_guid":"E37CAA7A91804236BAEFA07816349629","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"F1169A71E78B44EE9518E655CBB26EE2","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read file preparation"}},{"id":1054724,"guid":"7EC26B4870834234980838DB599BC875","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Determine the N50\/L50 read length for each barcode. This will be used as the initial guess at the assembly size.<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">(for bc in $(awk '{print $2}' barcode_counts.txt);<\/div><div class = \"text-block\">    do echo -n ${bc};<\/div><div class = \"text-block\">    fastx-length.pl demultiplexed\/reads_${bc}.fq.gz 2>&1 > \/dev\/null | \\<\/div><div class = \"text-block\">      grep L50 | awk '{print \"\\t\"$5$6}' | perl -pe 's\/b$\/\/';<\/div><div class = \"text-block\"> done) > results\/read_L50.txt<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">This file can be viewed to confirm the assembly lengths:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Example output:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">BC02    347<\/div><div class = \"text-block\">BC03    8.904k<\/div><div class = \"text-block\">BC04    8.888k<\/div><div class = \"text-block\">BC05    10.262k<\/div><div class = \"text-block\">BC07    11.076k<\/div><div class = \"text-block\">BC09    11.093k<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\"><span style = \"font-style:italic;\">Note: this file will be used for subsequent downstream processing. If any of these barcodes shouldn't be processed further, feel free to remove the corresponding lines from this file<\/span><\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245605,"guid":"A7FA52A5876E4C92BB872A6AC045D794","previous_id":1245604,"previous_guid":"5D51F041C2FB45A8AF2FD7BF9490D92F","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"9E92EF88FD004EA3B5291DEB1E2C9F61","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read filitering"}},{"id":1054724,"guid":"A52AEDA4D9DE4BD6B0CA2F4B42C9C83D","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Filter out any reads that are less than half of the target read length, and determine the average quality of the remainder, keeping information on (at most) 100 of the highest-quality reads:<\/div><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  ~\/scripts\/fastx-compstats.pl demultiplexed\/reads_${bc}.fq.gz | \\<\/div><div class = \"text-block\">    sort -t ',' -k 16rn,16 | \\<\/div><div class = \"text-block\">    awk -F ',' -v \"len=${len}\" \\<\/div><div class = \"text-block\">      'BEGIN{if(match(len, \"k\") > 0){sub(\"k\",\"\",len); len=len*1000}}<\/div><div class = \"text-block\">       {if($18 > (len \/ 2)){print}}' | \\<\/div><div class = \"text-block\">    head -n 100 | grep -v '^name' > results\/bestLong_100X_${bc}.csv;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Check how successful the sequencer was at getting 100X coverage by counting lines:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">wc -l results\/bestLong_100X_*.csv<\/div><\/div><\/code><\/pre><\/div><div class = \"text-block\">Example output. In this case BC02 has fewer than 100 reads, so the assembly is less likely to be high-quality:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">  90 results\/bestLong_100X_BC02.csv<\/div><div class = \"text-block\"> 100 results\/bestLong_100X_BC03.csv<\/div><div class = \"text-block\"> 100 results\/bestLong_100X_BC04.csv<\/div><div class = \"text-block\"> 100 results\/bestLong_100X_BC05.csv<\/div><div class = \"text-block\"> 100 results\/bestLong_100X_BC07.csv<\/div><div class = \"text-block\"> 100 results\/bestLong_100X_BC09.csv<\/div><div class = \"text-block\">590 total<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245606,"guid":"1962907AE2C2474D9604AE86C0EF7E15","previous_id":1245605,"previous_guid":"A7FA52A5876E4C92BB872A6AC045D794","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"09DE1B26A0B3486CB08FB09EE4EC3A32","order_id":1,"type_id":6,"title":"Section","source":{"title":"Read filitering"}},{"id":1054724,"guid":"F34C0988BF4F4D2FAC267EB62FDBD1A0","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Subset the original read sets to only include the high-quality long reads:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  ~\/scripts\/fastx-fetch.pl -i results\/bestLong_100X_${bc}.csv \\<\/div><div class = \"text-block\">    demultiplexed\/reads_${bc}.fq.gz > results\/bestLong_100X_${bc}.fastq; done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245607,"guid":"788500DAFE444757815B8C3991CFC6E7","previous_id":1245606,"previous_guid":"1962907AE2C2474D9604AE86C0EF7E15","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"ECCA417C34954DF7B39B1D55E41508C2","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 1: mapping to a reference sequence"}},{"id":1054724,"guid":"FD146576A7434A3299E1E22C87462327","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Create a LAST index for the reference sequence:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">lastdb -uNEAR -R01 reference\/refName.fa reference\/refName.fa<\/div><\/div><\/code><\/pre><\/div><br\/><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245608,"guid":"9DFA8E9334304827A83A857D61040C8E","previous_id":1245607,"previous_guid":"788500DAFE444757815B8C3991CFC6E7","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"2E176F554076495B86F4EE335A403AE9","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 1: mapping to a reference sequence"}},{"id":1054724,"guid":"DE149B4DB37649FD9125A830EB063F9C","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><br\/><div class = \"text-block\">Prepare a substitution matrix for barcode mapping. The default substitution matrix is swayed too much by INDELs in the barcode sequences, so here's one that I've developed using a combination of trial & error and last-train. This should work at least for reads called with Guppy v4.2.2:<\/div><br\/><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">#last -Q 0<\/div><div class = \"text-block\">#last -t4.385<\/div><div class = \"text-block\">#last -a 16<\/div><div class = \"text-block\">#last -A 19<\/div><div class = \"text-block\">#last -b 4<\/div><div class = \"text-block\">#last -B 3<\/div><div class = \"text-block\">#last -S 1<\/div><div class = \"text-block\"># score matrix (query letters = columns, reference letters = rows):<\/div><div class = \"text-block\">       A      C      G      T<\/div><div class = \"text-block\">A      7    -26    -10    -24<\/div><div class = \"text-block\">C    -26      5    -32    -22<\/div><div class = \"text-block\">G    -10    -32      5    -29<\/div><div class = \"text-block\">T    -24    -22    -29      7<\/div><\/div><\/code><\/pre><\/div><br\/><br\/><div class = \"text-block\">This matrix has a moderate penalty for opening gaps (i.e. insertions and deletions), and a lower penalty for inserting them. Insertions are slightly less likely than deletions. It also has a moderate penalty for A\/G transition variants, and a higher penalty for C\/T transition variants (but still lower than other substitution penalties).<\/div><br\/><div class = \"text-block\"><span>If you're interested in training your own model based on this one, you can use <\/span><span style = \"font-style:italic;\">last-train<\/span><span> as follows:<\/span><\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">last-train --matsym -Q 0 -p plasmid_best100.mat \\<\/div><div class = \"text-block\">  reference\/refName.fa results\/bestLong_100X_BC*.fastq<\/div><\/div><\/code><\/pre><\/div><br\/><div class = \"text-block\"><span>Copy the last few lines from the output into a text file (e.g. `<\/span><span style = \"font-style:italic;\">plasmid_better.mat<\/span><span>`)<\/span><\/div><\/div>"}},{"id":1054725,"guid":"1A6B48C040BC11EBB6BA27DC30446EAE","order_id":2,"type_id":23,"title":"file","source":{"source":"https:\/\/s3.amazonaws.com\/protocols-files\/public\/d3caf5d2f980d165712bb8262c51687a45460e9aedd9631ff736620da233c966\/ctvvjpt6.mat","placeholder":"","original_name":"plasmid_best100.mat"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245609,"guid":"FE35A8A769134B9AB09C0BA6C3B640EF","previous_id":1245608,"previous_guid":"9DFA8E9334304827A83A857D61040C8E","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"FDE2C26F41BB47B38F008CD378C7088A","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 1: mapping to a reference sequence"}},{"id":1054724,"guid":"BAAC370A5312473981831AFF84304339","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"><span>Map reads to the reference and convert to BAM format using <\/span><span style = \"font-style:italic;\">maf-convert<\/span><span> and <\/span><span style = \"font-style:italic;\">samtools<\/span><span style = \"font-style:italic;\">:<\/span><\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  lastal -j 7 -Q 0 -p plasmid_best100.mat reference\/refName.fa \\<\/div><div class = \"text-block\">      results\/bestLong_100X_${bc}.fastq | last-split -n -m 0.99 | last-postmask | \\<\/div><div class = \"text-block\">    maf-convert sam | samtools view -h --reference reference\/refName.fa | \\<\/div><div class = \"text-block\">    samtools sort > results\/${bc}_vs_refName.bam<\/div><div class = \"text-block\">  samtools index results\/${bc}_vs_refName.bam<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245610,"guid":"6D7B4797C3C1448CA4B387E9FB14BDC9","previous_id":1245609,"previous_guid":"FE35A8A769134B9AB09C0BA6C3B640EF","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"4C1DCEEC8DCC465B92659D432A16C7B8","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 1: mapping to a reference sequence"}},{"id":1054724,"guid":"1512DF52BFE44AA39C1CE65085A29D49","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Split reads into forward and reverse-mapped sequences, and tally up base counts at each location:<\/div><br\/><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  samtools view -b -F 0x10 results\/${bc}_vs_refName.bam | \\<\/div><div class = \"text-block\">    samtools mpileup --reference reference\/refName.fa -B -Q 0 - | \\<\/div><div class = \"text-block\">    ~\/scripts\/readstomper.pl -c > results\/fwd_stomped_${bc}_vs_refName.csv<\/div><div class = \"text-block\">  samtools view -b -f 0x10 results\/${bc}_vs_refName.bam | \\<\/div><div class = \"text-block\">    samtools mpileup --reference reference\/refName.fa -B -Q 0 - | \\<\/div><div class = \"text-block\">    ~\/scripts\/readstomper.pl -c > results\/rev_stomped_${bc}_vs_refName.csv<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245611,"guid":"7F72CDE65AFB4C51A935855DFDAD8854","previous_id":1245610,"previous_guid":"6D7B4797C3C1448CA4B387E9FB14BDC9","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"A5A21E01C63D48D8B0E3C7B3B90DB1BC","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 1: mapping to a reference sequence"}},{"id":1054724,"guid":"DB1E73CBA5F141B4B5106EC93CFD91A7","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Create a visualisation of the base-stomped output:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;\n  do echo ${bc} ${len};\n  ~\/scripts\/stomp_plotter.r -f results\/fwd_stomped_BC02_vs_refName.csv \\<\/div><div class = \"text-block\">    -r results\/rev_stomped_BC02_vs_refName.csv -prefix results\/BC02\ndone<\/div><\/div><\/code><\/pre><\/div><br\/><div class = \"text-block\"><span>Example output (<\/span><span style = \"font-style:italic;\">`results\/BC02_stompPlot_reference_seq.png<\/span><span>`):<\/span><\/div><br\/><br\/><div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/eb5sjpt6.jpg\" \/><\/div><br\/><br\/><\/div>"}},{"id":1054725,"guid":"557AEFB666A5456B81C021F5D9A4E067","order_id":2,"type_id":1,"title":"description","source":{"description":"<div style = \"text-align :; float : ;\"><img style = \"\" src = \"https:\/\/s3.amazonaws.com\/protocols-files\/files\/eb5sjpt6.jpg\" \/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#84CE84","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245612,"guid":"121125616BD949E1AD51E3A858F22901","previous_id":1245611,"previous_guid":"7F72CDE65AFB4C51A935855DFDAD8854","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"2B61F43E6A4948319B6E4D99CE6C9F78","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 2: De-novo Canu Assembly"}},{"id":1054724,"guid":"BC45F7AD55CD4220895955311DCED8B6","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Run a Canu assembly on each read set, using default options:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do canu -nanopore results\/bestLong_100X_${bc}.fastq \\<\/div><div class = \"text-block\">    -p ${bc} -d results\/canu_${bc} genomeSize=${len};<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#FFED92","section_duration":0,"critical":null,"critical_id":null,"duration":0},{"id":1245613,"guid":"2D2B2E3E01A444EC801ADB3F490E455A","previous_id":1245612,"previous_guid":"121125616BD949E1AD51E3A858F22901","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"729B0EBFF5DD483A823B410C405DE12D","order_id":1,"type_id":6,"title":"Section","source":{"title":"Choice 2: De-novo Canu Assembly"}},{"id":1054724,"guid":"0B4FAD1C00764FB09FDB8442A503C7E2","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">Trim the assembled contigs based on Canu's trim recommendations:<\/div><br\/><div class = \"text-block\"><pre><code><div class = \"text-blocks\"><div class = \"text-block\">cat results\/read_L50.txt | while read bc len;<\/div><div class = \"text-block\">  do echo ${bc} ${len};<\/div><div class = \"text-block\">  samtools faidx results\/canu_${bc}\/${bc}.contigs.fasta \\<\/div><div class = \"text-block\">    $(grep '^>' results\/canu_${bc}\/${bc}.contigs.fasta | \\<\/div><div class = \"text-block\">      perl -pe 's\/^>(.*?) .*trim=(.*)\/$1:$2\/') > results\/circTrimmed_${bc}.fasta;<\/div><div class = \"text-block\">done<\/div><\/div><\/code><\/pre><\/div><br\/><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#FFED92","section_duration":0,"critical":null,"critical_id":null,"duration":0}],"document":"","materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\">This protocol demonstrates how to assemble reads from plasmid DNA, and generate a circularised and non-repetitive consensus sequence<\/div><br\/><div class = \"text-block\">At the moment, this protocol uses Canu to de-novo assemble high-quality single-cut reads.<\/div><br\/><div class = \"text-block\"><span style = \"font-weight:bold;\">Input(s)<\/span><span>: <\/span><\/div><div class = \"text-block\"><ul style = \"list-style-type:disc;\"><li style = \"counter-reset:ol0;list-style-type:disc;\"><span>demultiplexed fastq files (see protocol <\/span><a href=\"https:\/\/dx.doi.org\/10.17504\/protocols.io.7vmhn46\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">Demultiplexing Nanopore reads with LAST<\/span><\/a><span>). I've noticed that the default demultiplexing carried out by Guppy (at least up to v4.2.2, as used in the first version of this protocol) has issues with <\/span><a href=\"https:\/\/doi.org\/10.12688\/f1000research.11547.2\" style = \"text-decoration:underline;color:blue;cursor:pointer;\"><span style = \":;\">chimeric reads<\/span><\/a><span>, which can affect assembly.<\/span><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\"><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\"><span style = \"font-weight:bold;\">Output(s):<\/span><\/li><li style = \"counter-reset:ol0;list-style-type:disc;\">Consensus sequence per barcode as a fasta file<\/li><\/ul><\/div><br\/><div class = \"text-block\"><span style = \"font-weight:bold;\">Output(s):<\/span><\/div><div class = \"text-block\"><ul style = \"list-style-type:disc;\"><\/ul><\/div><\/div>","changed_on":1630713667}