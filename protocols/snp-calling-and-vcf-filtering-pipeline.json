{"id":29543,"title":"SNP Calling and VCF Filtering Pipeline","title_html":"SNP Calling and VCF Filtering Pipeline","image":{"source":"https:\/\/www.protocols.io\/img\/default_protocol.png","placeholder":"https:\/\/www.protocols.io\/img\/default_protocol.png"},"doi":"dx.doi.org\/10.17504\/protocols.io.84fhytn","doi_status":2,"uri":"snp-calling-and-vcf-filtering-pipeline-84fhytn","type_id":1,"template_id":1,"published_on":1596128845,"parent_protocols":[],"parent_collections":[],"cited_protocols":[],"version_id":0,"created_on":1573077508,"categories":null,"creator":{"name":"M Renee Bellinger","affiliation":"University of Hawaii at Hilo","affiliations":[{"affiliation":"University of Hawaii at Hilo","url":"","is_default":1}],"username":"m-renee-bellinger","link":null,"image":{"source":"\/img\/avatars\/015.png","placeholder":"\/img\/avatars\/015.png"},"badges":[{"id":2,"image":{"source":"\/img\/badges\/bronze.svg","placeholder":"\/img\/badges\/bronze.svg"},"name":"Author"}],"verified":0,"is_verified_user":false,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false},"journal":null,"journal_name":null,"journal_link":null,"article_citation":null,"public":1,"has_versions":0,"link":null,"total_collections":0,"number_of_steps":16,"authors":[{"name":"M Renee Bellinger","affiliation":"University of Hawaii at Hilo","affiliations":[],"username":"m-renee-bellinger","link":null,"image":{"source":"\/img\/avatars\/015.png","placeholder":"\/img\/avatars\/015.png"},"badges":[],"verified":1,"is_verified_user":true,"research_interests":null,"blocked_by_you":false,"blocked_you":false,"hide_following":false}],"versions":[],"groups":[],"is_owner":1,"has_subprotocols":0,"is_subprotocol":0,"is_bookmarked":0,"can_claim_authorship":0,"can_accept_authorship":0,"can_be_copied":1,"can_remove_fork":1,"fork_id":null,"url":"https:\/\/www.protocols.io\/view\/snp-calling-and-vcf-filtering-pipeline-84fhytn","forks_count":{"private":0,"public":0},"access":{"can_view":1,"can_remove":0,"can_add":0,"can_edit":0,"can_publish":0,"can_get_doi":0,"can_share":1,"can_move":1,"can_move_outside":1,"can_transfer":1,"can_download":1,"is_locked":0},"guid":"885C0DF000E011EAA40A6B9DDC3A0615","state_version_id":926,"steps":[{"id":842593,"guid":"DF8BBBA000EC11EAA40A6B9DDC3A0615","previous_id":842612,"previous_guid":"1B115A8000EE11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"68669074157943459062C5548C621E5D","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"0E5EB0042EEF472087BCB0AE446802D1","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"># copy the genome to a working folder and unzip it to be a \"working copy\"<\/div><div class = \"text-block\">cp \/your\/path\/to\/genome\/genome.gz genome.fasta.gz<\/div><div class = \"text-block\">gunzip genome.fasta.gz<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842595,"guid":"F3E9F76000EC11EAA40A6B9DDC3A0615","previous_id":842593,"previous_guid":"DF8BBBA000EC11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"4749E91AF9E14685A6BA2A0D57449418","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"D18D6FDAC210436FB1EA21A1CF0E5564","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"># index genome<\/div><div class = \"text-block\">samtools faidx genome.fasta<\/div><div class = \"text-block\">bowtie2-build genome.fasta genome<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842596,"guid":"F93FC7D000EC11EAA40A6B9DDC3A0615","previous_id":842595,"previous_guid":"F3E9F76000EC11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"8567E5FE4ED54C0B8B4393F49CADC350","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"AC24DAA8DBFE45809CBF63C71EEBB288","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"># Map demultiplexed GBS reads with bowtie2 or a program of your choice. Repeat this step for all demultiplexed samples<\/div><div class = \"text-block\"># settings are -q for fastq format, -p for 20 threads, --very-sensitive-local for alignment algorithm, -x for reference, -U name of demultiplexed read file (e.g., P230.R1.fastq). -S is output file \"P230.sam\"<\/div><div class = \"text-block\">bowtie2 -q -p 20 --very-sensitive-local -x genome -U P230.R1.fastq -S P230.sam<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842597,"guid":"FE00361000EC11EAA40A6B9DDC3A0615","previous_id":842596,"previous_guid":"F93FC7D000EC11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"E897D14BC68C4BBBBB851486D9F78FA5","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"A7BC13B75D3E4CC2871822804472F3D5","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"># Use samtools to convert *sam to *bam format, sort the reads, filter out unmapped reads (-F 4) to save space, and then check mapping stats<\/div><div class = \"text-block\"># this loop will process all *sam files in your working directory<\/div><div class = \"text-block\"># note some samtools programs use -o while others use > to collect program output<\/div><div class = \"text-block\">for i in *sam;<\/div><div class = \"text-block\">do<\/div><div class = \"text-block\">       samtools view -bS -o $i.bam $i --threads 20<\/div><div class = \"text-block\">       samtools sort $i.bam -o $i.sort.bam --threads 20<\/div><div class = \"text-block\">       samtools view -h -F 4 $i.sort.bam > $i.mapped.bam<\/div><div class = \"text-block\">       samtools flagstat $i.mapped.bam > $i.mapped.sort.stats<\/div><div class = \"text-block\">done;<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842598,"guid":"03D76B8000ED11EAA40A6B9DDC3A0615","previous_id":842597,"previous_guid":"FE00361000EC11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"6B34C2782D8F41448A4415A2B795C139","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"EEA5C6111E1941D0B78BEC600F82E9F8","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">#calculate genotype likelihoods and call variants<\/div><div class = \"text-block\">samtools mpileup -gu -f genome.fasta -q 20 -Q 20 --output-tags DP,AD,ADF,ADR,SP,INFO\/AD *mapped.bam | bcftools call -m --output-type v -o draft_Taro.merged_q20Q20.vcf<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842599,"guid":"093EEF3000ED11EAA40A6B9DDC3A0615","previous_id":842598,"previous_guid":"03D76B8000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"17DE3592A4E8424BBC5543A76CD9803E","order_id":1,"type_id":6,"title":"Section","source":{"title":"CALL SNPS"}},{"id":1054724,"guid":"4C17D57CEAAE4D97A22F9D77D4C7C2FE","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\"># compress the *vcf to save space<\/div><div class = \"text-block\">gzip draft_Taro.merged_q20Q20.vcf<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#A492FF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842600,"guid":"13A570C000ED11EAA40A6B9DDC3A0615","previous_id":842599,"previous_guid":"093EEF3000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"7A46F9722C2E495897E59684D0E22C60","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"A5F54CAD80934D36B5B88A1CFDB23A23","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## I use variables for this script. Would be easier to run the file 1_SNP_calling.txt provided on page with Abstract<\/div><div class = \"text-block\">## This step remove samples that are not part of the mapping population<\/div><div class = \"text-block\">A=draft_Taro.merged_q20Q20.vcf.gz <\/div><div class = \"text-block\">vcftools --gzvcf $A --keep keep_1025_230_255.txt --recode --recode-INFO-all --out 1025_230_255<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842601,"guid":"1FC3183000ED11EAA40A6B9DDC3A0615","previous_id":842600,"previous_guid":"13A570C000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"CCB6DDF647EE406283B116EAC89CC15C","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"FDAD1DF2131945E38ADECED6EB20EAAA","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Remove SNPs within 5 bases of an INDEL<\/div><div class = \"text-block\">B=1025_230_255.recode.vcf<\/div><div class = \"text-block\">bcftools filter -g 5 $B >filter.1.vcf<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842602,"guid":"302A774000ED11EAA40A6B9DDC3A0615","previous_id":842601,"previous_guid":"1FC3183000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"0D5C46424952450F9E92B588C8D87D5A","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"DD0895F0E88348C493A26CBDF66DF861","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Remove indels<\/div><div class = \"text-block\">C=filter.1.vcf<\/div><div class = \"text-block\">vcftools --vcf $C --keep keep_1025_230_255 --remove-indels --recode --recode-INFO-all --out 1025_230_255.noindel<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842606,"guid":"351B445000ED11EAA40A6B9DDC3A0615","previous_id":842602,"previous_guid":"302A774000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"F3F12FA401D74E4589D1126E901458EC","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"19143ACABE3A46808E9E52637E7525DE","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## light filter for max missing 50%, minimum depth of 5 (per genotype), bi-allelic calls, minimum quality phred 20<\/div><div class = \"text-block\">## remove samples that are not the 1025 taro leaf blight mapping population<\/div><div class = \"text-block\">D=1025_230_255.noindel.recode.vcf<\/div><div class = \"text-block\">vcftools --vcf $D --max-missing 0.5 --minDP 5 --min-alleles 2 --max-alleles 2 --minQ 20 --recode --recode-INFO-all --out 1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842607,"guid":"39E7997000ED11EAA40A6B9DDC3A0615","previous_id":842606,"previous_guid":"351B445000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"3264D64BDBC64EDC9069387768676E3F","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"7804F442586A47FF8DCE00A33298E7E3","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Measure missingness across individuals and create a file listing individuals missing >30% of data <\/div><div class = \"text-block\">E=1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20.recode.vcf<\/div><div class = \"text-block\">vcftools --vcf $E --missing-indv --out 30percent<\/div><div class = \"text-block\">cat 30percent.imiss | awk '{if($5>0.3)print $1}'|grep -v INDV> remove-indv_30perc<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842608,"guid":"5498070000ED11EAA40A6B9DDC3A0615","previous_id":842607,"previous_guid":"39E7997000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"388900180C954CB8B329E9F0AB2378D9","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"F4C96E1D0A3D45E998578909EB694A41","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Remove individuals missing 30% data in conjunction with the light filter <\/div><div class = \"text-block\">D=1025_230_255.noindel.recode.vcf <\/div><div class = \"text-block\">vcftools --vcf $D --remove remove-indv_30perc --max-missing 0.5 --minDP 5 --min-alleles 2  --max-alleles 2 --minQ 20 --recode --recode-INFO-all --out 1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20.n86ind<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842609,"guid":"6BD08BE000ED11EAA40A6B9DDC3A0615","previous_id":842608,"previous_guid":"5498070000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"4417C2480DF843F2B223FA00ECE36D13","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"F29CFCB42B0243FBAF1773E77492F633","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Measure missingness across loci and create a file \"exclude_miss20p\". Apply this file in step 15.<\/div><div class = \"text-block\">F=1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20.n86ind.recode.vcf<\/div><div class = \"text-block\">vcftools --vcf $F --keep keep_1025_230_255 --missing-site --out 1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20<\/div><div class = \"text-block\">cat 1025_230_255.noindel.maxmiss.5.minDP5.2alleles.minQ20.lmiss|awk '{if($6>=0.20)print $1, $2}'>exclude_miss20p<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842610,"guid":"755D283000ED11EAA40A6B9DDC3A0615","previous_id":842609,"previous_guid":"6BD08BE000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"155212AF9E3B49EBA3EF1CBC1ED0BFE0","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"DB13F517980341B3AB18798109CDC805","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Apply stringent filter:<\/div><div class = \"text-block\">## Exclude individuals missing 30% of data and loci that are missing 20% of data<\/div><div class = \"text-block\">## some filters are redundant in case steps are run out of order<\/div><div class = \"text-block\">## apply minimum genotypic depth of 8<\/div><div class = \"text-block\">G=1025_230_255.noindel.recode.vcf<\/div><div class = \"text-block\">vcftools --vcf $G --remove remove-indv_30perc --exclude-positions exclude_miss20p --max-missing 0.8 --minDP 8 --min-alleles 2 --max-alleles 2 --minQ 20 --recode --recode-INFO-all --out 1025_230_255.noindel.maxmiss.8.minDP8.2alleles.minQ20.n86<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842611,"guid":"8DD35D3000ED11EAA40A6B9DDC3A0615","previous_id":842610,"previous_guid":"755D283000ED11EAA40A6B9DDC3A0615","modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"B52B3EBD5C7046738C91255016E14E77","order_id":1,"type_id":6,"title":"Section","source":{"title":"Filter SNPs in *vcf file"}},{"id":1054724,"guid":"D071EADF19024A62BA27DED3061F2755","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">## Apply minor allele frequency filter<\/div><div class = \"text-block\">vcftools --vcf 1025_230_255.noindel.maxmiss.8.minDP8.2alleles.minQ20.n86_variable_parental.recode.vcf.recode.vcf --maf 0.012 --recode --recode-INFO-all --out 1025_230_255.noindel.maxmiss.8.minDP8.2alleles.minQ20.n86_variable_parents_maf_0.012<\/div><div class = \"text-block\"># filtered file is: 1025_230_255.noindel.maxmiss.8.minDP8.2alleles.minQ20.n86_variable_parents_maf_0.012.recode.vcf <\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"#94EBFF","section_duration":0,"critical":[],"critical_id":null,"duration":0},{"id":842612,"guid":"1B115A8000EE11EAA40A6B9DDC3A0615","previous_id":null,"previous_guid":null,"modified_on":0,"protocol_id":0,"components":[{"id":1054723,"guid":"8444097E79494F25818A69C92490CBB2","order_id":1,"type_id":6,"title":"Section","source":{"title":""}},{"id":1054724,"guid":"458E1A527CF74FAEB0404655516EE064","order_id":1,"type_id":1,"title":"description","source":{"description":"<div class = \"text-blocks\"><div class = \"text-block\">###############<\/div><div class = \"text-block\"># SNP calling #<\/div><div class = \"text-block\">###############<\/div><div class = \"text-block\"># To set up your working environment you will need to download GBS and genome data from NCBI<\/div><div class = \"text-block\"># Set paths to each program if they are not in your bash environment.<\/div><div class = \"text-block\">#----------------------------------#<\/div><div class = \"text-block\"># Programs and versions used for SNP calling<\/div><div class = \"text-block\">#----------------------------------#<\/div><div class = \"text-block\"># bowtie2v2.2.4<\/div><div class = \"text-block\"># samtools1.4.1<\/div><div class = \"text-block\"># bcftools-1.2 <\/div><div class = \"text-block\">#----------------------------------#<\/div><div class = \"text-block\"># DATA FILES<\/div><div class = \"text-block\">#----------------------------------#<\/div><div class = \"text-block\"># Short-read files that have been demultiplexed (see Guidelines)<\/div><div class = \"text-block\"># SRX2754311 --> GBS data for Taro from Hawaii, South Pacific, Palau, and mainland Asia <\/div><div class = \"text-block\"># SRX2754311 --> GBS data for the '1025' Taro mapping population resistant to Taro Leaf Blight<\/div><div class = \"text-block\"># GENOME FILE<\/div><div class = \"text-block\"># NCBI Bioproject PRJNA567267<\/div><\/div>"}}],"cases":[],"data":null,"html":null,"section":null,"section_color":"","section_duration":0,"critical":[],"critical_id":null,"duration":0}],"document":null,"materials":[],"description":"<div class = \"text-blocks\"><div class = \"text-block\">SNP-calling and genotype filtering using bowtie2, samtools, bcftools, and vcftools<\/div><div class = \"text-block\"><span>This pipeline  was used for calling SNPs using GBS data obtained from Taro Leaf Blight resistant mapping population of taro, <\/span><span style = \"font-style:italic;\">Colocasia Esculenta <\/span><span>mapped to a taro genome assembled from 10x Genomics linked-reads and Oxford Nanopore Technology long-reads.<\/span><\/div><div class = \"text-block\">The genotype filtering is meant to be done in a single job submission on a linux machine (this was run using 20 cores with 120 Gb RAM and takes two to three days).<\/div><div class = \"text-block\">The file \"1_SNP_calling.txt\" contains steps for calling SNPs from demultiplexed GBS data and filtering vcf files (these are broken out in \"Steps\".<\/div><div class = \"text-block\">The file \"2_genome_analysis\" contains steps for running NLR-Annotator and Mummer with Nucmer algorithm to generate synteny plots. This is not broken out in steps<\/div><\/div>","changed_on":1596128845}