{"access":{"can_view":true,"can_edit":false,"can_remove":false,"can_add":false,"can_publish":false,"can_get_doi":false,"can_share":true,"can_move":true,"can_move_outside":true,"can_transfer":true,"can_download":true,"limited_run":false,"limited_private_links":false,"limited_blind_links":false,"is_locked":false},"authors":[{"name":"chuqingsun","affiliation":"Huazhong University of Science and Techonology","affiliation_url":null,"username":"n4ule102q1w4ule1","link":null,"image":{"source":"/img/avatars/007.png","placeholder":"/img/avatars/007.png","webp_source":""},"note":"","is_verified_user":true}],"before_start":"","book_chapter":null,"can_accept_authorship":false,"can_be_copied":true,"can_claim_authorship":false,"can_manage_keywords":true,"can_remove_fork":false,"can_sign":false,"child_steps":{},"cited_protocols":[],"collection_items":[],"created_on":1692013029,"creator":{"name":"chuqingsun","affiliation":"","affiliation_url":null,"username":"n4ule102q1w4ule1","link":null,"image":{"source":"/img/avatars/007.png","placeholder":"/img/avatars/007.png","webp_source":""},"badges":[{"id":2,"name":"Author","image":{"source":"/img/badges/bronze.svg","placeholder":"/img/badges/bronze.svg"}}],"affiliations":[]},"description":"{\"blocks\":[{\"key\":\"afo3h\",\"text\":\"Current metagenome-assembled human gut phage catalogs contained mostly fragmented genomes. Here, we developed a vigorous gut virome detection procedure involving viral-like particle enrichment from increased amount of feces (~500g) and combined sequencing of short- and long-reads. Applied to 135 fecal samples, we assembled a Chinese Gut Virome Catalog (CHGV) consisting of 21,646 non-redundant phage genomes that were significantly longer than those obtained by short-read sequencing and contained ~35% complete ones, which was ~nine times more than those in the Gut Virome Database (~4%). Interestingly, majority (~60%) of the CHGV genomes were obtained by either long-read or hybrid assemblies, which overlapped little with those assembled from only the short-reads, indicating the necessity of combined sequencing in gut virome discovery. With this dataset, we elucidated the vast diversity of the gut virome from several aspects, including the identification of 32% novel genomes as compared with public gut virome databases, dozens of phages that were more prevalent than the crAssphages and/or Gubaphages, and several viral clades that are more diverse than the two. In the end, we also characterized the functional capacities of the CHGV encoded proteins and constructed a viral-host interaction network to facilitate future research and applications of the gut viruses.\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{}}","disclaimer":"","document":"","documents":[],"doi":"dx.doi.org/10.17504/protocols.io.36wgq339klk5/v1","doi_status":1,"ethics_statement":null,"fork_id":null,"fork_info":null,"forks":[],"funders":[],"groups":[],"guid":"DBBDF9B03A9611EEBCD1D1346B10DCE9","guidelines":"","has_references":false,"has_step_reagents":false,"has_versions":true,"id":86442,"image":{"source":"https://www.protocols.io/img/default_protocol.png","webp_source":null,"placeholder":"https://www.protocols.io/img/default_protocol.png","webp_placeholder":null},"image_attribution":"","in_trash":false,"is_bookmarked":false,"is_contact_suspended":false,"is_content_confidential":false,"is_content_warning":false,"is_doi_reserved":false,"is_in_pending_publishing":false,"is_in_transfer":false,"is_owner":true,"is_research":true,"is_retracted":false,"is_shared_directly":false,"is_subprotocol":null,"is_unlisted":false,"item_id":1150878,"journal":null,"journals":[],"keywords":"","last_modified":1692029558,"link":"","location":null,"manuscript_citation":"","materials":[],"materials_text":"","ownership_history":null,"parent_collections":[],"parent_protocols":[],"peer_reviewed":false,"protocol_references":"","public":true,"public_fork_note":"","published_on":1692029558,"references":[],"related_equipments":[],"related_materials":[],"reserved_doi":"","retraction_reason":null,"samples":{},"shared_access_id":16,"show_comparison":true,"sign_info":null,"state_version_id":153,"stats":{"is_voted":false,"number_of_views":0,"number_of_steps":7,"number_of_bookmarks":0,"number_of_comments":0,"number_of_bookmarked_comments":0,"number_of_steps_comments":0,"number_of_protocol_comments":0,"number_of_exports":0,"number_of_runs":0,"number_of_votes":0,"number_of_reagents":0,"number_of_equipments":0,"number_of_collections":0,"number_of_forks":{"private":0,"public":0},"number_of_accessible_forks":0},"status":{"id":3,"info":"We attempted this protocol but could not get it to work in our workspace"},"steps":[{"id":1764402,"guid":"E72040603A9611EEBCD1D1346B10DCE9","previous_id":0,"previous_guid":null,"section":"\u003cp\u003eAssembly\u003c/p\u003e","section_color":"#A492FF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"6tcr4\",\"text\":\"NGS Assembly\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":12},{\"style\":\"italic\",\"offset\":0,\"length\":12}],\"entityRanges\":[],\"data\":{}},{\"key\":\"87ab6\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"6cpik\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"f0mfb\",\"text\":\"#!/bin/bash\\n#SBATCH --cpus-per-task=16\\n#SBATCH -o slurm.%N.%j.out        # STDOUT\\n#SBATCH -e slurm.%N.%j.err        # STDERR\\n\\ninfile=$1\\nNGS_PATH=$2\\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:~/local/lib:/mnt/raid6/sunchuqing/Softwares/MCR/v94/runtime/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/sys/os/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/extern/glnxa64：/mnt/raid3/wchen/miniconda2/pkgs/libgcc-7.2.0-h69d50b8_2/lib\\ncd NGS\\nmkdir -p 02_trimmed 03_bac_cpn60 03_human_hg38 04_Stats\\nmkdir -p 05_Removed 06_Assembly 07_CD-HIT\\n\\nTRIMMO_JAR_FILE='/mnt/raid1/tools/ngs_tools/Trimmomatic-0.38/trimmomatic-0.38.jar'\\nTRIMMO_ADAPTOR_FILE_PE='/mnt/raid1/tools/ngs_tools/Trimmomatic-0.38/adapters/TruSeq3-PE.fa'\\nR1=`ls ${NGS_PATH}/*${infile}*R1*|head -n 1 `\\nR2=`ls ${NGS_PATH}/*${infile}*R2*|head -n 1 `\\n\\nif [ ! -s 02_trimmed/${infile}_clean.1.fq ];then\\n    java -jar $TRIMMO_JAR_FILE PE -threads 16 ${R1} ${R2} 02_trimmed/${infile}_clean.1.fq 02_trimmed/${infile}_clean_unpaired.1.fq 02_trimmed/${infile}_clean.2.fq 02_trimmed/${infile}_clean_unpaired.2.fq ILLUMINACLIP:$TRIMMO_ADAPTOR_FILE_PE:2:15:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:15:30 MINLEN:50\\nfi\\n#rm human\\nexport PATH=/home/sunchuqing/bin:/mnt/raid6/sunchuqing/Softwares/miniconda3/condabin:/mnt/raid6/sunchuqing/Softwares/miniconda3/bin:/mnt/raid8/sunchuqing/Softwares/bin:/mnt/raid1/puzi/software/metaphlan2:/mnt/raid1/puzi/software/metaphlan2/utils:/usr/bin:/usr/local/ncbi/sra-tools/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/raid6/sunchuqing/Softwares/miniconda3/bin:/mnt/raid1/sunchuqing/bc/bc/h/parallel-meta/bin:/mnt/raid6/sunchuqing/Softwares/miniconda3/bin://mnt/raid1/data/Software/prokka/bin:/mnt/raid6/sunchuqing/Softwares/miniconda3/bin:/mnt/raid7/sunchuqing/Softwares/bin\\n\\nbowtie2 -p 16 --un-conc 05_Removed/${infile}_%.fastq --no-unal -k 20 -x /mnt/raid5/sunchuqing/Human_Gut_Phage/ref/hg38_ref -1 02_trimmed/${infile}_clean.1.fq -2 02_trimmed/${infile}_clean.2.fq \\u003elog \\nbowtie2 -p 16 --al-conc 05_Removed/${infile}_%_prophage.fastq --end-to-end -x /mnt/raid7/sunchuqing/Human_Gut_Phage/db/HGYG_prophage -1 05_Removed/${infile}_1.fastq -2 05_Removed/${infile}_2.fastq -S ../04_Abundance/${infile}_NGS_HGYG_prophage.sam   \\u003elog \\nbowtie2 -p 16 --un-conc 05_Removed/${infile}_%_phage.fastq --end-to-end -x /mnt/raid7/sunchuqing/Human_Gut_Phage/db/HGYG -1 05_Removed/${infile}_1.fastq -2 05_Removed/${infile}_2.fastq -S ../04_Abundance/${infile}_NGS_HGYG.sam  \\u003elog \\ncat 05_Removed/${infile}_1_prophage.fastq 05_Removed/${infile}_1_phage.fastq \\u003e 05_Removed/${infile}_virome_bft_1.fastq\\ncat 05_Removed/${infile}_2_prophage.fastq 05_Removed/${infile}_2_phage.fastq \\u003e 05_Removed/${infile}_virome_bft_2.fastq\\n\\nR1=`ls 05_Removed/${infile}_virome_bft_1.fastq`\\nR2=`ls 05_Removed/${infile}_virome_bft_2.fastq`\\njava -jar $TRIMMO_JAR_FILE PE -threads 16 ${R1} ${R2} 05_Removed/${infile}_virome_1.fastq 02_trimmed/${infile}_clean_unpaired.vir.1.fq 05_Removed/${infile}_virome_2.fastq 02_trimmed/${infile}_clean_unpaired.vir.2.fq ILLUMINACLIP:$TRIMMO_ADAPTOR_FILE_PE:2:15:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:15:30 MINLEN:50\\n\\nexport PYTHONPATH=/mnt/raid6/sunchuqing/Softwares/miniconda3/lib/python3.7/site-packages:/mnt/raid8/sunchuqing/Softwares/lib/site-packages\\n# casper 02_trimmed/${infile}_clean.1.fq  02_trimmed/${infile}_clean.2.fq  -o 02_trimmed/${infile}_clean.merged -t 16\\npandaseq -f 02_trimmed/${infile}_clean.1.fq -r 02_trimmed/${infile}_clean.2.fq -F -w 02_trimmed/${infile}_clean.merged.fastq -T 16\\nexport PATH=$PATH:/mnt/raid6/sunchuqing/Softwares/miniconda3/bin\\n#16s\\n/mnt/raid6/sunchuqing/Softwares/ViromeQC/viromeqc/viromeQC.py  \\\\\\n    -i 02_trimmed/${infile}_clean.merged.fastq \\\\\\n    -o 04_Stats/${infile}.viromeqc \\\\\\n    --bowtie2_threads 16\\\\\\n    --diamond_threads 16\\n#bac=`tail -n 1 04_Stats/${infile}.viromeqc | awk 'BEGIN {FS=\\\"\\\\t\\\"} {print $4}'`\\nbacpct=`tail -n 1 04_Stats/${infile}.viromeqc | awk 'BEGIN {FS=\\\"\\\\t\\\"} {print $4}'`\\n# /mnt/raid5/sunchuqing/Softwares/SortMeRNA/sortmerna-2.1/sortmerna --ref /mnt/raid5/sunchuqing/Softwares/SortMeRNA/sortmerna-2.1/rRNA_databases/silva-bac-16s-id90.fasta,/mnt/raid5/sunchuqing/Softwares/SortMeRNA/sortmerna-2.1/index/silva-bac-16s-db --reads 02_trimmed/${infile}_clean.merged.fastq --aligned 03_bac/${infile} --blast 1\\n#bowtie2 -x /mnt/raid6/sunchuqing/Database/Bacteria_bowtie/bac -1 02_trimmed/${infile}_clean.1.fq -2 02_trimmed/${infile}_clean.2.fq -S 03_bac/${infile}.sam\\n#bac=`/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools flagstat 03_bac/${infile}.sam | grep 'mapped' | awk 'BEGIN {FS=\\\" \\\"} {print $1}' | head -n 1`\\n\\n\\n#cpn60\\nbowtie2 -x /mnt/raid5/sunchuqing/Human_Gut_Phage/ref/cpn60_ref -1 02_trimmed/${infile}_clean.1.fq -2 02_trimmed/${infile}_clean.2.fq -S 03_bac_cpn60/${infile}.sam\\ncpn=`/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools flagstat 03_bac_cpn60/${infile}.sam | grep 'mapped' | awk 'BEGIN {FS=\\\" \\\"} {print $1}' | head -n 1`\\nreads=`/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools flagstat 03_bac_cpn60/${infile}.sam | grep 'total' | awk 'BEGIN {FS=\\\" \\\"} {print $1}' | head -n 1`\\n\\n#hg38\\nbowtie2 -x /mnt/raid5/sunchuqing/Human_Gut_Phage/ref/hg38_ref -1 02_trimmed/${infile}_clean.1.fq -2 02_trimmed/${infile}_clean.2.fq -S 03_human_hg38/${infile}.sam\\n#/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools flagstat 03_human_hg38/${infile}.sam\\nhuman=`/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools flagstat 03_human_hg38/${infile}.sam | grep 'mapped' | awk 'BEGIN {FS=\\\" \\\"} {print $1}' | head -n 1`\\n\\n#bacpct=`awk 'BEGIN {printf \\\"%.10f\\\\n\\\",(\\\"'\\\"${bac}\\\"'\\\"*100/\\\"'\\\"$reads\\\"'\\\")}'`\\n#bacpct=${bac}\\\"%\\\"\\nhumanpct=`awk 'BEGIN {printf \\\"%.10f\\\\n\\\",(\\\"'\\\"${human}\\\"'\\\"*100/\\\"'\\\"$reads\\\"'\\\")}'`\\ncpnpct=`awk 'BEGIN {printf \\\"%.10f\\\\n\\\",(\\\"'\\\"${cpn}\\\"'\\\"*100/\\\"'\\\"$reads\\\"'\\\")}'`\\necho \\\"File_name,reads_num,16spct,cpn60_reads,cpn60pct,human_reads,humanpct\\\"\\u003e04_Stats/${infile}.csv\\necho \\\"${infile},${reads},${bacpct}%,${cpn},${cpnpct}%,${human},${humanpct}%\\\" \\u003e\\u003e04_Stats/${infile}.csv\\n\\n#IDBA\\n/mnt/raid5/sunchuqing/Softwares/idba/bin/fq2fa --merge --filter 05_Removed/${infile}_virome_1.fastq 05_Removed/${infile}_virome_2.fastq 05_Removed/${infile}.fa\\n/mnt/raid5/sunchuqing/Softwares/idba/bin/idba_ud -r 05_Removed/${infile}.fa --maxk 120 --step 10 -o 06_Assembly/${infile} --num_threads 16 --min_contig 1000\\n\\ncat 06_Assembly/${infile}/contig.fa \\u003e06_Assembly/${infile}.fasta\\n/mnt/raid6/sunchuqing/Softwares/cdhit-master/cd-hit-est -i 06_Assembly/${infile}.fasta -o 07_CD-HIT/${infile}.fa -c 0.95 -n 5 -T 15 -M 16000 \\u003e07_CD-HIT/${infile}.log\\n\\ncd ..\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"1","cases":[],"critical":null},{"id":1764405,"guid":"4D712F003A9711EEBCD1D1346B10DCE9","previous_id":1764402,"previous_guid":"E72040603A9611EEBCD1D1346B10DCE9","section":"\u003cp\u003eAssembly\u003c/p\u003e","section_color":"#A492FF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"3797u\",\"text\":\"# TGS assembly\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":14},{\"style\":\"italic\",\"offset\":0,\"length\":14}],\"entityRanges\":[],\"data\":{}},{\"key\":\"8mh7p\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"fvamf\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"eogt3\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"4plj7\",\"text\":\"#!/bin/bash\\n#SBATCH --cpus-per-task=16\\n#SBATCH -o slurm.%N.%j.out        # STDOUT\\n#SBATCH -e slurm.%N.%j.err        # STDERR\\n\\ninfile=$1\\nNGS_PATH=$2\\nG3_PATH=$3\\nSoftware='/mnt/raid6/sunchuqing/Softwares'\\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:~/local/lib:/mnt/raid6/sunchuqing/Softwares/MCR/v94/runtime/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/sys/os/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/extern/glnxa64：/mnt/raid3/wchen/miniconda2/pkgs/libgcc-7.2.0-h69d50b8_2/lib\\ncd G3\\nmkdir -p 01_ccs 02_Removed/${infile}\\n#Run CCS corrction\\nCCS=`ls ${G3_PATH}/*${infile}*.subreads.bam `\\nif [ ! -s 02_Removed/${infile}/${infile}.virome.fastq ];then\\n  if [ ! -s ${G3_PATH}/CCS/${infile}.subreads.bam ];then\\n    ${Software}/miniconda3/bin/ccs ${CCS} 01_ccs/${infile}.ccs.fastq -j 16\\n  else \\n    CCS=`ls ${G3_PATH}/CCS/${infile}.subreads.bam`\\n    bedtools bamtofastq -i ${CCS} -fq 01_ccs/${infile}.ccs.fastq\\n  fi\\n  #Remove human genome\\n  bowtie2 -p 16 --un 02_Removed/${infile}/${infile}.fastq  -x /mnt/raid5/sunchuqing/Human_Gut_Phage/ref/hg38_ref -U 01_ccs/${infile}.ccs.fastq  \\u003e log\\n  bowtie2 --end-to-end -x /mnt/raid7/sunchuqing/Human_Gut_Phage/db/HGYG_prophage -U 02_Removed/${infile}/${infile}.fastq -S ../04_Abundance/${infile}_G3_HGYG_prophage.sam -p 16 --al 02_Removed/${infile}/${infile}.prophage.fastq --quiet\\n  bowtie2 --end-to-end -x /mnt/raid7/sunchuqing/Human_Gut_Phage/db/HGYG -U 02_Removed/${infile}/${infile}.fastq -S ../04_Abundance/${infile}_G3_HGYG.sam -p 16 --un 02_Removed/${infile}/${infile}.phage.fastq --quiet\\n  cat 02_Removed/${infile}/${infile}.prophage.fastq 02_Removed/${infile}/${infile}.phage.fastq \\u003e 02_Removed/${infile}/${infile}.virome.fastq\\n  seqtk seq -a 02_Removed/${infile}/${infile}.virome.fastq  | /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/seqkit rmdup -s -o  02_Removed/${infile}/${infile}.fa\\n  rm 02_Removed/${infile}/${infile}.*hage.fastq 02_Removed/${infile}/${infile}.fastq\\nfi\\n\\n\\n#Assembly with Canu\\nrm -rf 03_canu_Assembly/${infile}\\nmkdir -p 03_canu_Assembly/${infile}\\nG3=`pwd`\\ncd 03_canu_Assembly/${infile}\\nhost=`hostname`\\nif [ \\\"$host\\\" = \\\"bork\\\" ];then \\n    /mnt/raid7/sunchuqing/Softwares/OPERAMS-bork/canu/build/bin/canu  \\\\\\n      -p ${infile} \\\\\\n      -d ./ genomeSize=20k corOutCoverage=1 \\\\\\n      -corrected \\\\\\n      -pacbio ../../02_Removed/${infile}/${infile}.fa  \\\\\\n      useGrid=false\\nelse\\n    /mnt/raid6/sunchuqing/Softwares/canu/Linux-amd64/bin/canu  \\\\\\n      -p ${infile} \\\\\\n      -d ./ genomeSize=20k corOutCoverage=1 \\\\\\n      -corrected \\\\\\n      -pacbio ../../02_Removed/${infile}/${infile}.fa  \\\\\\n      useGrid=false\\nfi\\n\\ncd ${G3}\\n\\n#Assembly with Flye\\nmkdir -p 03_Flye_Assembly/${infile}\\nmkdir -p 05_Assembly/${infile}\\nzcat 03_canu_Assembly/$infile/${infile}.trimmedReads.fasta.gz \\u003e03_canu_Assembly/$infile/${infile}.trimmedReads.fasta\\nflye --pacbio-corr  02_Removed/${infile}/${infile}.fa \\\\\\n  --meta --genome-size 20k \\\\\\n  --out-dir 03_Flye_Assembly/${infile}/ \\\\\\n  --threads 16  --min-overlap 1000\\ncat 03_canu_Assembly/${infile}/${infile}.contigs.fasta 03_Flye_Assembly/${infile}/assembly.fasta \\u003e 05_Assembly/${infile}_fc.fa\\n\\n#Binning with MetaBAT\\nif [ -s 03_canu_Assembly/${infile}/${infile}.unitigs.fasta ];then\\n  mkdir -p 04_MetaBAT_Assembly/${infile}\\n  cd 04_MetaBAT_Assembly/${infile}\\n  mkdir -p db\\n  bowtie2-build ../../03_canu_Assembly/${infile}/${infile}.unitigs.fasta db/${infile}\\n  bowtie2 -x db/${infile} -U ../../01_ccs/${infile}.ccs.fastq -S ${infile}.sam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools view -bS ${infile}.sam -o ${infile}.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools sort ${infile}.bam \\u003e ${infile}.sort.bam\\n  ${Software}/berkeleylab-metabat*/bin/jgi_summarize_bam_contig_depths --outputDepth depth_var.txt ${infile}.sort.bam\\n  ${Software}/berkeleylab-metabat*/bin/metabat -i ../../03_canu_Assembly/${infile}/${infile}.unitigs.fasta -a depth_var.txt  -o metabat -v \\n\\n  for file in ./metabat.*.fa\\n    do\\n      num=${file//[!0-9]/}\\n      #echo $num\\n      sed -e \\\"/^\\u003e/ s/$/ ${num}/\\\" metabat.$num.fa  \\u003e\\u003e metabat_binned.concat.fasta \\n  done\\n  grep '\\u003e' metabat_binned.concat.fasta | sed 's/\\u003e//g' \\u003e metabat_binned.info\\n\\n  \\n  cd ../../05_Assembly/${infile}\\n  cut -f1 ../../03_canu_Assembly/${infile}/${infile}.unitigs.bed | sort|uniq -c \\u003e contig.list\\n  while read -r contig\\n  do\\n    num=`echo ${contig} | awk 'BEGIN {FS=\\\" \\\"} {print $1}'`\\n    tig=`echo ${contig} | awk 'BEGIN {FS=\\\"ctg\\\"} {print $2}'`\\n    if [ $num -eq 1 ];then\\n      awk '/^\\u003e/ {printf(\\\"\\\\n%s\\\\t\\\",$0);next;} {printf(\\\"%s\\\",$0);} END {printf(\\\"\\\\n\\\");}' \\u003c ../../03_canu_Assembly/${infile}/${infile}.contigs.fasta |egrep -v '^$'|tr \\\"\\\\t\\\" \\\"\\\\n\\\" \\u003e../../03_canu_Assembly/${infile}/${infile}.n1.contigs.fasta\\n      grep \\\"$tig\\\" ../../03_canu_Assembly/${infile}/${infile}.n1.contigs.fasta -A 1|sed 's/\\u003etig/\\u003ectg/g' \\u003e\\u003e ../${infile}.fasta\\n      echo $tig \\u003e\\u003e infa.contig.list  \\n      grep \\\"ctg${tig}\\\" ../../03_canu_Assembly/${infile}/${infile}.unitigs.bed |cut -f4 \\u003e\\u003einfa.unitig.list\\n    else\\n      grep \\\"ctg${tig}\\\" ../../03_canu_Assembly/${infile}/${infile}.unitigs.bed |cut -f4 \\u003eunitig.list\\n      sed 's/utg/tig/g' unitig.list \\u003e uni.list\\n      binnum=`grep -Ff uni.list ../../04_MetaBAT_Assembly/${infile}/metabat_binned.info | awk 'BEGIN {FS=\\\" \\\"} {print $2}' |sort |uniq |wc -l`\\n      inbin=`grep -Ff uni.list ../../04_MetaBAT_Assembly/${infile}/metabat_binned.info|wc -l`\\n      uninum=`cat unitig.list | wc -l `\\n      #echo \\\"$binnum,$uninum,${inbin}\\\"\\n      if [[ $binnum == 1 \\u0026\\u0026 $uninum == $inbin ]];then\\n      \\n        grep \\\"$tig\\\" ../../03_canu_Assembly/${infile}/${infile}.contigs.fasta -A 100| awk -v RS='\\u003e' 'NR\\u003e1{i++}i==1{print \\\"\\u003e\\\"$0}' \\u003e\\u003e ../${infile}.fasta\\n        echo $tig \\u003e\\u003e infa.contig.list\\n        cat unitig.list \\u003e\\u003e infa.unitig.list\\n      fi\\n    fi\\n  \\n  done \\u003c\\\"contig.list\\\" \\n  cut -f4 ../../03_canu_Assembly/${infile}/${infile}.unitigs.bed \\u003eunitig.list \\n  awk '/^\\u003e/ {printf(\\\"\\\\n%s\\\\t\\\",$0);next;} {printf(\\\"%s\\\",$0);} END {printf(\\\"\\\\n\\\");}' \\u003c ../../03_canu_Assembly/${infile}/${infile}.unitigs.fasta |egrep -v '^$'|tr \\\"\\\\t\\\" \\\"\\\\n\\\" \\u003e../../03_canu_Assembly/${infile}/${infile}.n1.unitigs.fasta\\n  for unitig in `grep -v -Ff infa.unitig.list unitig.list `\\n  do\\n    tig=`echo ${unitig} | awk 'BEGIN {FS=\\\"utg\\\"} {print $2}'`\\n    #echo $tig\\n    grep \\\"$tig\\\" ../../03_canu_Assembly/${infile}/${infile}.n1.unitigs.fasta -A 1 | sed 's/class=contig/class=unitig/g'|sed 's/\\u003etig/\\u003eutg/g' \\u003e\\u003e ../${infile}.fasta\\n  done\\n  cat ../../03_Flye_Assembly/${infile}/assembly.fasta ../${infile}.fasta \\u003e ../${infile}_fc.fa\\n  cd ../..\\nfi\\nmkdir -p 06_CD-HIT/${infile}\\n/mnt/raid6/sunchuqing/Softwares/cdhit-master/cd-hit-est -i 05_Assembly/${infile}_fc.fa -o 06_CD-HIT/${infile}/${infile}.fa -c 0.95 -n 5 -T 16 -M 16000 \\n\\n\\nSoftware='/mnt/raid6/sunchuqing/Softwares'\\nPATH=\\\"/mnt/raid6/sunchuqing/Softwares/miniconda3/bin\\\":$PATH\\nif [ -s ${NGS_PATH}/*${infile}*R1* ];then\\n  if [ ! -s ../NGS/02_trimmed/*${infile}*clean.1.fq ];then\\n    TRIMMO_JAR_FILE='/mnt/raid1/tools/ngs_tools/Trimmomatic-0.38/trimmomatic-0.38.jar'\\n    TRIMMO_ADAPTOR_FILE_PE='/mnt/raid1/tools/ngs_tools/Trimmomatic-0.38/adapters/TruSeq3-PE.fa'\\n    R1=`ls ${NGS_PATH}/*${infile}*R1*`\\n    R2=`ls ${NGS_PATH}/*${infile}*R2*`\\n    mkdir -p ../NGS/02_trimmed\\n    java -jar $TRIMMO_JAR_FILE PE -threads 4 $R1 $R2 ../NGS/02_trimmed/${infile}_clean.1.fq ../NGS/02_trimmed/${infile}_clean_unpaired.1.fq ../NGS/02_trimmed/${infile}_clean.2.fq ../NGS/02_trimmed/${infile}_clean_unpaired.2.fq ILLUMINACLIP:$TRIMMO_ADAPTOR_FILE_PE:2:15:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:15:30 MINLEN:50\\n  fi\\n  mkdir -p 07_Pilon/${infile}\\n  cd 07_Pilon/${infile}\\n  mkdir -p index\\n  bwa index -p index/draft ../../06_CD-HIT/${infile}/${infile}.fa\\n  R1=`ls ../../../NGS/02_trimmed/*${infile}*clean.1.fq`\\n  R2=`ls ../../../NGS/02_trimmed/*${infile}*clean.2.fq`\\n  bwa mem -t 16 index/draft ${R1} ${R2} | /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools sort -@ 10 -O bam -o align.bam\\n /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools index -@ 10 align.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools sort -n align.bam \\u003e align.sort.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools fixmate -m align.sort.bam fixmate.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools sort -o align.som.bam fixmate.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools markdup align.som.bam align_markdup.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools view -@ 10 -q 30 -b align_markdup.bam \\u003e align_filter.bam\\n  /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/samtools index -@ 10 align_filter.bam\\n  java -Xmx5G -jar ${Software}/pilon-1.23.jar --genome ../../06_CD-HIT/${infile}/${infile}.fa --frags align_filter.bam \\\\\\n      --fix snps,indels \\\\\\n      --output ${infile}.pilon \\n  cd ../..\\nfi\\ncd ..\\n\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"2","cases":[],"critical":null},{"id":1764406,"guid":"A0A5D7C03A9711EEBCD1D1346B10DCE9","previous_id":1764405,"previous_guid":"4D712F003A9711EEBCD1D1346B10DCE9","section":"\u003cp\u003eAssembly\u003c/p\u003e","section_color":"#A492FF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"4e29k\",\"text\":\"Hybrid Assembly\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":15},{\"style\":\"italic\",\"offset\":0,\"length\":15}],\"entityRanges\":[],\"data\":{}},{\"key\":\"feac9\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"5a6hl\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"2ecvc\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"5sd7n\",\"text\":\"#!/bin/bash\\n#SBATCH --cpus-per-task=16\\n#SBATCH -o slurm.%N.%j.out        # STDOUT\\n#SBATCH -e slurm.%N.%j.err        # STDERR\\n\\ncd G2G3\\ninfile=$1\\nNGS_PATH=\\nG3_PATH=\\nSoftware=\\nR1=`ls ../NGS/05_Removed/${infile}_virome_1.fastq`\\nR2=`ls ../NGS/05_Removed/${infile}_virome_2.fastq`\\nCCS=\\\"../G3/02_Removed/${infile}\\\"\\n#rm -rf 01_OPERA_MS_assembly/${infile}\\nmkdir -p 01_OPERA_MS_assembly/${infile}\\nchmod 777 01_OPERA_MS_assembly/${infile}\\n\\nperl OPERA-MS.pl \\\\\\n    --short-read1 $R1 \\\\\\n    --short-read2 $R2 \\\\\\n    --long-read ${CCS}/${infile}.virome.fastq \\\\\\n    --out-dir 01_OPERA_MS_assembly/${infile} \\\\\\n    --contig-len-thr 1000 \\\\\\n    --num-processors 64 \\\\\\n    --polishing --no-strain-clustering --no-ref-clustering\\n\\n\\n#metaSPAdes\\nmkdir -p 02_metaSPAdes/${infile}\\n\\n/mnt/raid6/sunchuqing/Softwares/SPAdes-3.13.1-Linux/bin/metaspades.py \\\\\\n    --pacbio ${CCS}/${infile}.virome.fastq \\\\\\n    -1 $R1 \\\\\\n    -2 $R2 \\\\\\n    -o 02_metaSPAdes/${infile} \\\\\\n    -t 16 \\\\\\n    -m 750\\n\\nmkdir -p 02_CD-HIT/${infile}\\ncat 02_metaSPAdes/${infile}/contigs.fasta 01_OPERA_MS_assembly/${infile}/contigs.fasta \\u003e 02_CD-HIT/${infile}/${infile}.all.fa\\n/mnt/raid6/sunchuqing/Softwares/cdhit-master/cd-hit-est -i 02_CD-HIT/${infile}/${infile}.all.fa -o 02_CD-HIT/${infile}/${infile}.fa -c 0.95 -n 8 -T 16 -M 16000 \\ncd ..\\n\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"3","cases":[],"critical":null},{"id":1764407,"guid":"B6B9D9D03A9711EEBCD1D1346B10DCE9","previous_id":1764406,"previous_guid":"A0A5D7C03A9711EEBCD1D1346B10DCE9","section":"\u003cp\u003eAdditional analysis\u003c/p\u003e","section_color":"#94EBFF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"fcjrn\",\"text\":\"Viral annotation\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":16},{\"style\":\"italic\",\"offset\":0,\"length\":16}],\"entityRanges\":[],\"data\":{}},{\"key\":\"7n170\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"euq5e\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"an8t7\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"6hl6t\",\"text\":\"#!/usr/bin/bash\\ninfile=$1\\nexport PATH=/mnt/raid8/sunchuqing/Softwares/blast2.2.26/ncbi-blast-2.2.26+/bin:/mnt/raid7/sunchuqing/Softwares/bin:$PATH:/home/sunchuqing/.local/bin:/mnt/raid6/sunchuqing/Softwares/VirSorter/VirSorter/bin:/mnt/raid6/sunchuqing/Softwares/VirSorter/VirSorter:/usr/bin:/mnt/raid6/sunchuqing/Softwares/miniconda3/envs/virsorter/bin:/mnt/raid6/sunchuqing/Softwares/PPR-Meta:/mnt/raid6/sunchuqing/Softwares/miniconda3/envs/virsorter/bin:/usr/local/bin\\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/mnt/raid6/sunchuqing/Softwares/MCR/v94/bin/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/runtime/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/sys/os/glnxa64:/mnt/raid6/sunchuqing/Softwares/MCR/v94/extern/glnxa64:/mnt/raid3/wchen/miniconda2/pkgs/libgcc-7.2.0-h69d50b8_2/lib\\n\\necho \\\"Dealing with $infile\\\"\\n\\nexport LD_LIBRARY_PATH=/mnt/raid8/sunchuqing/Softwares/lib/perllib:$LD_LIBRARY_PATH\\nexport PERL5LIB=/mnt/raid8/sunchuqing/Softwares/lib/perllib:$PERL5LIB\\nfafile=\\\"00_CAT/${infile}_cdhit.len1.5k.fa\\\"\\nseq=\\\"00_CAT/${infile}_cdhit.len1.5k.fa\\\"\\nif [ ! -s $seq ];then\\n    awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }'  00_CAT/${infile}_cdhit.fa |awk 'length($NF)\\u003e=1500 {print $1\\\"\\\\n\\\"$NF}' \\u003e 00_CAT/${infile}_cdhit.len1.5k.fa\\nfi\\n\\nn1=`ls 01_Glimmer/${infile}/*.predict|wc -l`\\nn2=`grep -c \\\"\\u003e\\\" 00_CAT/${infile}_cdhit.len1.5k.fa `\\n\\nif [ $n1 -ne $n2 ];then\\n    #awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }'  00_CAT/${infile}_cdhit.fa |awk 'length($NF)\\u003e=1500 {print $1\\\"\\\\n\\\"$NF}'| \\u003e 00_CAT/${infile}_cdhit.len1.5k.fa\\n    #awk '/^\\u003e/{s=++num}{print \\u003e \\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\";close(\\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\")}' file=\\\"${infile}\\\" $fafile\\n    rm -rf 01_Glimmer/${infile}\\n    mkdir -p 01_Glimmer/${infile}\\n    #awk '/^\\u003e/{s=++num}{print \\u003e \\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\"}' file=\\\"${infile}\\\" $fafile\\n    #awk '/^\\u003e/{s=++num}{print \\u003e\\u003e \\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\";close(\\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\")}' file=\\\"${infile}\\\" $fafile\\n    awk '/^\\u003e/{s=++num}{print \\u003e \\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\";(\\\"01_Glimmer/\\\"file\\\"/\\\"file\\\"_\\\"s\\\"\\\")}' file=\\\"${infile}\\\" $fafile\\n    cd 01_Glimmer/${infile}\\n    ls | grep -v \\\"\\\\.\\\" | grep \\\".\\\" |awk 'BEGIN {FS=\\\".\\\"} {print $1}'|sort|uniq \\u003e ../${infile}.list\\n    while read -r line\\n    do\\n        /mnt/raid5/sunchuqing/Softwares/glimmer3.02/bin/long-orfs -n -t 1.15 ${line} ${line}.longorfs\\n        /mnt/raid5/sunchuqing/Softwares/glimmer3.02/bin/extract -t ${line} ${line}.longorfs \\u003e ${line}.train\\n        /mnt/raid5/sunchuqing/Softwares/glimmer3.02/bin/build-icm -r ${line}.icm \\u003c ${line}.train\\n        /mnt/raid5/sunchuqing/Softwares/glimmer3.02/bin/glimmer3 -o50 -g100 -t30 ${line} ${line}.icm ${line}\\n        /mnt/raid5/sunchuqing/Softwares/glimmer3.02/bin/extract -t ${line} ${line}.predict \\u003e ${line}_predict.fasta\\n    done \\u003c \\\"../${infile}.list\\\"\\n    cd ../..\\nfi\\nif [ ! -s \\\"01_Glimmer/${infile}/${infile}.faa \\\" ];then\\n    rm 01_Glimmer/${infile}/${infile}.faa\\n    while read -r line\\n    do      \\n            declare -i len=0\\n            declare -i aorf=0\\n            declare -i orflen=0\\n            len=`grep '\\u003e' 01_Glimmer/${infile}/${line}.predict |awk 'BEGIN {FS=\\\" \\\"} {print $2}' |awk 'BEGIN {FS=\\\"_\\\"} {print $2}'`\\n            orflen=`grep  \\\"\\u003e\\\" 01_Glimmer/${infile}/${line}_predict.fasta | awk 'BEGIN {FS=\\\"=\\\"} {print $2}'| awk '{sum+=$1}END{print sum}'`\\n            ((aorf=$orflen*10000))\\n            if [ $len -gt $aorf ]; then\\n                echo ${line} \\u003e\\u003e  02_Annotate/${infile}/${infile}.no_assignmnt_under10k\\n                continue\\n            fi\\n            sed \\\"s/^\\u003e/\\u003e${line}_/\\\" 01_Glimmer/${infile}/${line}_predict.fasta \\u003e\\u003e  01_Glimmer/${infile}/${infile}.faa        \\n    done \\u003c \\\"01_Glimmer/${infile}.list\\\"\\nfi\\n#VirSorter\\nmkdir -p 04_is_phage\\ncd 04_is_phage\\n\\n\\nif [ ! -s \\\"04_Positive/${infile}.VirSorter.genome\\\" ];then\\n    echo \\\"--Start virSorter--\\\"\\n    #rm -rf ./01_virsorter_result/${infile}\\n    mkdir -p 01_virsorter_result\\n    __conda_setup=\\\"$('/mnt/raid6/sunchuqing/Softwares/miniconda/bin/conda' 'shell.bash' 'hook' 2\\u003e /dev/null)\\\"\\n    if [ $? -eq 0 ]; then\\n        eval \\\"$__conda_setup\\\"\\n    else\\n        if [ -f \\\"/mnt/raid6/sunchuqing/Softwares/miniconda/etc/profile.d/conda.sh\\\" ]; then\\n            . \\\"/mnt/raid6/sunchuqing/Softwares/miniconda/etc/profile.d/conda.sh\\\"\\n        else\\n            export PATH=\\\"/mnt/raid6/sunchuqing/Softwares/miniconda/bin:$PATH\\\"\\n        fi\\n    fi\\n    unset __conda_setup\\n    # # \\u003c\\u003c\\u003c conda initialize \\u003c\\u003c\\u003c\\n    # source activate virsorter\\n   \\n    conda activate /mnt/raid6/sunchuqing/Softwares/miniconda3/envs/vs2\\n    virsorter run \\\\\\n        -w ./01_virsorter_result/${infile} \\\\\\n        -i ../00_CAT/${infile}_cdhit.len1.5k.fa \\\\\\n        --db-dir /mnt/raid8/sunchuqing/Softwares/Virsorterdb\\\\\\n        -j 16 --rm-tmpdir\\\\\\n        --tmpdir ./01_virsorter_result/${infile}/temp --min-score 0.7\\n    conda deactivate\\n    # mkdir -p 02_vir_positive\\n    # cat ./01_virsorter_result/${infile}/Predicted_viral_sequences/VIRSorter_cat-1.fasta ./01_virsorter_result/${infile}/Predicted_viral_sequences/VIRSorter_cat-2.fasta \\u003e 02_vir_positive/${infile}.vir.fasta\\n    # #VirSprter Positive 基因组 02_vir_positive/${infile}.vir.fasta\\n    mkdir -p 04_Positive\\n    #grep '\\u003e' 02_vir_positive/${infile}.vir.fasta |sed 's/\\u003eVIRSorter_//g'|sed 's/-cat_1//g'|sed 's/-cat_2//g'|sed 's/-circular//g' \\u003e 04_Positive/${infile}.VirSorter.genome\\n    cat ./01_virsorter_result/${infile}/final-viral-score.tsv | awk 'BEGIN {FS=\\\"|\\\"} {print $1}'|sort|uniq  \\u003e 04_Positive/${infile}.VirSorter.genome\\n    echo \\\"--End virSorter--\\\"\\nfi\\n\\n#Complete\\nif [ ! -s \\\"04_Positive/${infile}.cir.genome\\\" ];then\\n    mkdir -p 03_circle/db 03_circle/${infile}\\n    /mnt/raid8/sunchuqing/Softwares/blast2.2.26/ncbi-blast-2.2.26+/bin/makeblastdb -in ../00_CAT/${infile}_cdhit.len1.5k.fa -out 03_circle/db/${infile} -dbtype nucl \\n    blastall -p blastn \\\\\\n        -i ../00_CAT/${infile}_cdhit.len1.5k.fa  \\\\\\n        -d 03_circle/db/${infile} \\\\\\n        -o 03_circle/${infile}/${infile}.cir.tab \\\\\\n        -m 8 -e 1e-5 -a 16\\n    awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }' ../00_CAT/${infile}_cdhit.len1.5k.fa |awk '{print $1\\\",\\\"length($NF)}'|sed 's/\\u003e//g' \\u003e 03_circle/${infile}/${infile}.len\\n    awk 'BEGIN {FS=\\\"\\\\t\\\"} $1==$2 \\u0026\\u0026 $7==1 \\u0026\\u0026 $3==100.00 {print $0}' 03_circle/${infile}/${infile}.cir.tab \\u003e 03_circle/${infile}/${infile}.cir711.tab\\n    rm 03_circle/${infile}/${infile}.cir.len.tab\\n    while read -r line\\n    do\\n        contig=`echo $line |awk 'BEGIN {FS=\\\",\\\"} {print $1}'`\\n        sed \\\"s/^$contig\\\\t/$line\\\\t/g\\\" 03_circle/${infile}/${infile}.cir711.tab |grep \\\"$line\\\" \\u003e\\u003e 03_circle/${infile}/${infile}.cir.len.tab\\n    done \\u003c\\\"03_circle/${infile}/${infile}.len\\\"\\n    awk 'BEGIN {FS=\\\"[,\\\\t]\\\"} ( $2==$10 || $2==$11 ) \\u0026\\u0026 $2!=$9 {print $0}' 03_circle/${infile}/${infile}.cir.len.tab \\u003e 03_circle/${infile}/${infile}.circle.tab\\n    awk 'BEGIN {FS=\\\",\\\"} {print $1}' 03_circle/${infile}/${infile}.circle.tab |sed 's/^/\\u003e/g'  \\u003e 03_circle/${infile}/${infile}.complete\\n    awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\"\\\\n\\\":$0 }' ../00_CAT/${infile}_cdhit.len1.5k.fa \\u003e 03_circle/${infile}/${infile}.fna\\n    #grep -w -A 1 -Ff 03_circle/${infile}/${infile}.complete 03_circle/${infile}/${infile}.fna |grep -v \\\"-\\\" \\u003e 03_circle/${infile}/${infile}.complete.fa\\n    #mkdir -p 04_complete\\n    #cp 03_circle/${infile}/${infile}.complete.fa 04_complete/\\n    sed 's/\\u003e//g' 03_circle/${infile}/${infile}.complete \\u003e 04_Positive/${infile}.cir.genome\\nfi\\n#成环基因组 03_circle/${infile}/${infile}.complete\\n\\n#02_vir_positive/${infile}.vir.fasta\\n#pip install numpy\\n#pip install h5py\\n#pip install tensorflow==1.4.1  #CPU version\\n#pip install keras==2.0.8\\nif [ ! -s \\\"04_Positive/${infile}.ppr.genome\\\" ];then\\n    pathh=`pwd`\\n    #PPR_Meta\\n    # export PATH=/usr/bin:$PATH\\n    # \\u003e\\u003e\\u003e conda initialize \\u003e\\u003e\\u003e\\n    # !! Contents within this block are managed by 'conda init' !!\\n    __conda_setup=\\\"$('/mnt/raid6/sunchuqing/Softwares/miniconda/bin/conda' 'shell.bash' 'hook' 2\\u003e /dev/null)\\\"\\n    if [ $? -eq 0 ]; then\\n        eval \\\"$__conda_setup\\\"\\n    else\\n        if [ -f \\\"/mnt/raid6/sunchuqing/Softwares/miniconda/etc/profile.d/conda.sh\\\" ]; then\\n            . \\\"/mnt/raid6/sunchuqing/Softwares/miniconda/etc/profile.d/conda.sh\\\"\\n        else\\n            export PATH=\\\"/mnt/raid6/sunchuqing/Softwares/miniconda/bin:$PATH\\\"\\n        fi\\n    fi\\n    unset __conda_setup\\n\\n    # \\u003c\\u003c\\u003c conda initialize \\u003c\\u003c\\u003c\\n    conda activate /mnt/raid6/sunchuqing/Softwares/miniconda3/envs/tensorflow\\n\\n    pathh=`pwd`\\n    mkdir -p 03_PPR_META\\n    cd /mnt/raid6/sunchuqing/Softwares/PPR-Meta\\n    ./PPR_Meta $pathh/../00_CAT/${infile}_cdhit.len1.5k.fa $pathh/03_PPR_META/${infile}.csv\\n    cd $pathh\\n    awk 'BEGIN {FS=\\\",\\\"} $3\\u003e0.7 {print $1}'  03_PPR_META/${infile}.csv |awk 'BEGIN {FS=\\\" \\\"} {print $1}' \\u003e 04_Positive/${infile}.ppr.genome\\n    conda deactivate \\nfi\\n\\n#VirFinder\\n#Bork\\nif [ ! -s \\\"04_Positive/${infile}.virfiner.genome\\\" ];then\\n    mkdir -p 03_VirFinder\\n    /usr/bin/Rscript  /mnt/raid5/sunchuqing/Buffalo_gut/VirFinder.R ../00_CAT/${infile}_cdhit.len1.5k.fa 03_VirFinder/${infile}.csv\\n    #VirFinder输出文件\\n    awk 'BEGIN {FS=\\\",\\\"} $3\\u003e0.6 {print $1}' 03_VirFinder/${infile}.csv|awk 'BEGIN {FS=\\\" \\\"} {print $1}' \\u003e 04_Positive/${infile}.virfiner.genome\\nfi\\n#blast Virus ref\\nif [ ! -s \\\"04_Positive/${infile}.ref.genome\\\" ];then\\n    mkdir -p 03_Blast_m8/${infile}\\n    blastall -p blastn \\\\\\n        -i ../00_CAT/${infile}_cdhit.len1.5k.fa \\\\\\n        -d /mnt/raid6/sunchuqing/Database/Virus/virus \\\\\\n        -o 03_Blast_m8/${infile}/${infile}.m8.tab \\\\\\n        -m 8 -e 1e-10 -a 16\\n    grep -v -wFf /mnt/raid6/sunchuqing/Database/Virus/not.list 03_Blast_m8/${infile}/${infile}.m8.tab \\u003etmp \\u0026\\u0026 mv tmp 03_Blast_m8/${infile}/${infile}.m8.tab\\n    #echo \\\"chrom start   end\\\" \\u003e 03_Blast_m8/${infile}/${infile}.bed\\n    awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e50 {print $1 \\\"\\\\t\\\" $7 \\\"\\\\t\\\" $8 }' 03_Blast_m8/${infile}/${infile}.m8.tab |sort -k 1 -t $'\\\\t' |sed 's/[[:space:]]*$//'|tr -d \\\" \\\"|sort -k1,1 -k2,2n\\u003e 03_Blast_m8/${infile}/${infile}.bed.1\\n    /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/bedtools merge -i 03_Blast_m8/${infile}/${infile}.bed.1 \\u003e03_Blast_m8/${infile}/${infile}.bed\\n    sed 's/,/\\\\t/g' 03_circle/${infile}/${infile}.len \\u003e 03_Blast_m8/${infile}/${infile}.len\\n    cut -f 1 03_Blast_m8/${infile}/${infile}.len \\u003e 03_Blast_m8/${infile}/${infile}.list\\n    /mnt/raid6/sunchuqing/Softwares/miniconda3/bin/bedtools genomecov -i 03_Blast_m8/${infile}/${infile}.bed -g 03_Blast_m8/${infile}/${infile}.len |awk 'BEGIN {FS=\\\"\\\\t\\\"} $2\\u003e=1 {print $0}'|grep -v \\\"genome\\\" \\u003e 03_Blast_m8/${infile}/${infile}.bedtools\\n    rm 03_Blast_m8/${infile}/${infile}.genomecov.csv                                                 \\n    # while read -r line\\n    # do\\n    #     grep \\\"$line\\\" 03_Blast_m8/${infile}/${infile}.bedtools | awk 'BEGIN {FS=\\\"\\\\t\\\"} {sum += $NF} {print $1 \\\",\\\" sum*100}'|tail -n 1 \\u003e\\u003e 03_Blast_m8/${infile}/${infile}.genomecov.csv\\n    #     name=`grep \\\"$line\\\" 03_Blast_m8/${infile}/${infile}.bedtools |wc -l`\\n    #     if [ $name -eq 0 ];then\\n    #         echo \\\"$line,0\\\" \\u003e\\u003e 03_Blast_m8/${infile}/${infile}.genomecov.csv\\n    #     fi\\n    # done \\u003c\\\"03_Blast_m8/${infile}/${infile}.list\\\"\\n    awk 'BEGIN {FS=\\\",\\\"} $NF\\u003e0.9 {print $1}' 03_Blast_m8/${infile}/${infile}.genomecov.csv \\u003e 04_Positive/${infile}.ref.genome\\n    # awk 'BEGIN {FS=\\\",\\\"} $2\\u003e90  {print $0}' 03_Blast_m8/${infile}/${infile}.genomecov.csv \\u003e 03_Blast_m8/${infile}/${infile}.genomecov.over90.csv\\n    # awk 'BEGIN {FS=\\\",\\\"} {print $1}' 03_Blast_m8/${infile}/${infile}.genomecov.over90.csv \\u003e 04_Positive/${infile}.ref.genome\\nfi\\n#覆盖度超过90的基因组 03_Blast_m8/${infile}/${infile}.genomecov.over90.csv\\npathh=`pwd`\\n#blast pVOGs\\nif [ ! -s \\\"04_Positive/${infile}.pvog.genome\\\" ];then\\n    mkdir -p 03_Blast_pVOG/${infile}\\n    rm 03_Blast_pVOG/${infile}/${infile}_cds_num.csv\\n    cd ../01_Glimmer/${infile}\\n    ls | grep -v \\\"\\\\.\\\" | grep \\\".\\\" |awk 'BEGIN {FS=\\\".\\\"} {print $1}'|sort|uniq \\u003e ../${infile}.list\\n    cd $pathh\\n    blastall -p blastx -i ../01_Glimmer/${infile}/${infile}.faa -d /mnt/raid6/sunchuqing/Database/Virus/blastdb/POGseqs \\\\\\n            -o 03_Blast_pVOG/${infile}/${infile}.m8.tab \\\\\\n            -m 8 -e 1e-10 -a 16\\n    while read -r line\\n    do\\n        file=\\\"../01_Glimmer/${infile}/${line}\\\"\\n        filename=`echo \\\"$file\\\" | awk 'BEGIN {FS=\\\"/\\\"} {print $NF}'`\\n        CDSnum=`grep '\\u003e' ${file}_predict.fasta |wc -l `\\n        name=`grep '\\u003e' ../01_Glimmer/${infile}/${line} |head -n 1|sed 's/\\u003e//g' `\\n        length=`grep -w \\\"$name\\\" 03_Blast_m8/${infile}/${infile}.len`\\n        hitnum=`grep \\\"${filename}_\\\" 03_Blast_pVOG/${infile}/${infile}.m8.tab |awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e50 {print $1} ' |sort |uniq  |wc -l`\\n        echo \\\"$length,$CDSnum,$hitnum\\\"|sed 's/\\\\t/,/g'|awk 'BEGIN {FS=\\\",\\\"} $3\\u003e3 \\u0026\\u0026 $2/5000\\u003c$3 \\u0026\\u0026 $2/5000\\u003c$4 {print $0}' \\u003e\\u003e 03_Blast_pVOG/${infile}/${infile}_cds_num.csv\\n    done \\u003c\\\"../01_Glimmer/${infile}.list\\\"\\n    awk 'BEGIN {FS=\\\",\\\"} {print $1}'  03_Blast_pVOG/${infile}/${infile}_cds_num.csv \\u003e 04_Positive/${infile}.pvog.genome\\nfi\\nmkdir -p 05_Phage_Positive\\n\\nawk 'BEGIN {FS=\\\",\\\"} {print $1}'  03_Blast_pVOG/${infile}/${infile}_cds_num.csv \\u003e 04_Positive/${infile}.pvog.genome\\nawk 'BEGIN {FS=\\\",\\\"} {print $1}' 03_Blast_m8/${infile}/${infile}.genomecov.over90.csv \\u003e 04_Positive/${infile}.ref.genome\\nsed 's/\\u003e//g' 03_circle/${infile}/${infile}.complete \\u003e 04_Positive/${infile}.cir.genome\\nawk 'BEGIN {FS=\\\",\\\"} $3\\u003e0.6 {print $1}' 03_VirFinder/${infile}.csv|awk 'BEGIN {FS=\\\" \\\"} {print $1}' \\u003e 04_Positive/${infile}.virfiner.genome\\nawk 'BEGIN {FS=\\\",\\\"} $3\\u003e0.7 {print $1}'  03_PPR_META/${infile}.csv |awk 'BEGIN {FS=\\\" \\\"} {print $1}' \\u003e 04_Positive/${infile}.ppr.genome\\n#grep '\\u003e' 02_vir_positive/${infile}.vir.fasta |sed 's/\\u003eVIRSorter_//g'|sed 's/-cat_1//g'|sed 's/-cat_2//g'|sed 's/-circular//g' \\u003e 04_Positive/${infile}.VirSorter.genome\\n\\n#cat 04_Positive/${infile}*|sort |uniq -c|sort -n|awk 'BEGIN {FS=\\\" \\\"} $1\\u003e=1 {print $2}'|sed 's/_length/ length/g'|awk 'BEGIN {FS=\\\" \\\"} {print $1}'  \\u003e05_Phage_Positive/${infile}.phage.genome\\ncat 04_Positive/${infile}*|sort |uniq -c|sort -n|awk 'BEGIN {FS=\\\" \\\"} $1\\u003e=2 {print $2}'|sed 's/_length/ length/g'|awk 'BEGIN {FS=\\\" \\\"} {print $1}'  \\u003e05_Phage_Positive/${infile}.phage.genome2\\ncat 04_Positive/${infile}.cir.genome \\u003e\\u003e 05_Phage_Positive/${infile}.phage.genome2\\nsed 's/_length/ length/g' 03_circle/${infile}/${infile}.fna \\u003e 03_circle/${infile}/${infile}.fna2\\n#grep -w -A 1 -Ff 05_Phage_Positive/${infile}.phage.genome 03_circle/${infile}/${infile}.fna2 |grep -v -e \\\"--\\\" \\u003e 05_Phage_Positive/${infile}.phage.genome.fa\\ngrep -w -A 1 -Ff 05_Phage_Positive/${infile}.phage.genome2 03_circle/${infile}/${infile}.fna2 |grep -v -e \\\"--\\\" |awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }' |awk '{print $1\\\",\\\"length($NF)}'|sed 's/\\u003e//g' |awk 'BEGIN {FS=\\\",\\\"} $2\\u003e1500 {print $1}'|sort|uniq \\u003e 05_Phage_Positive/${infile}_fullfill2\\ngrep -w -A 1 -Ff 05_Phage_Positive/${infile}.phage.genome2 03_circle/${infile}/${infile}.fna2 |grep -v -e \\\"--\\\" |awk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }' |awk '{print $1\\\",\\\"length($NF)}'|sed 's/\\u003e//g' |awk 'BEGIN {FS=\\\",\\\"} $2\\u003e1500 {print $0}'|sort|uniq \\u003e 05_Phage_Positive/${infile}_fullfill2.length.csv\\n\\ngrep -w -A 1 -Ff 05_Phage_Positive/${infile}_fullfill2 03_circle/${infile}/${infile}.fna2 |grep -v -e \\\"--\\\" \\u003e 05_Phage_Positive/${infile}.phage.1.5k.genome.fa\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"4","cases":[],"critical":null},{"id":1764408,"guid":"D9C604D03A9711EEBCD1D1346B10DCE9","previous_id":1764407,"previous_guid":"B6B9D9D03A9711EEBCD1D1346B10DCE9","section":"\u003cp\u003eAdditional analysis\u003c/p\u003e","section_color":"#94EBFF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"7nlh3\",\"text\":\"UHGG filteration\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":16},{\"style\":\"italic\",\"offset\":0,\"length\":16}],\"entityRanges\":[],\"data\":{}},{\"key\":\"16bgp\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"7ehf6\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"b17d5\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"8n105\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"81ln7\",\"text\":\"\\n#UHGG filter----\\n    seq=../CHGV.filtered.fa\\n    infile=CHGV\\n    blastall -p blastn \\\\\\n        -i $seq \\\\\\n        -d /mnt/raid8/sunchuqing/Database/UHGG/uhgg\\\\\\n        -o ./${infile}.uhgg.m8.tab \\\\\\n        -m 8 -e 1e-10 -a 20\\n    \\n    blastall -p blastn \\\\\\n        -i $seq \\\\\\n        -d /mnt/raid7/sunchuqing/Human_Gut_Phage/HGYG/db/HGYG_prophage \\\\\\n        -o ./${infile}.uhgg.pro.m8.tab \\\\\\n        -m 8 -e 1e-10 -a 20\\n    awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e90 {print $1 \\\"\\\\t\\\" $7 \\\"\\\\t\\\" $8 }' ./${infile}.uhgg.m8.tab |sort -k 1 -t $'\\\\t' |sed 's/[[:space:]]*$//'|tr -d \\\" \\\"|sort -k1,1 -k2,2n\\u003e ${infile}.uhgg.bed.1\\n    bedtools merge -i ${infile}.uhgg.bed.1 \\u003e${infile}.uhgg.bed\\n    seqtk comp $seq|cut -f 1,2 \\u003e ${infile}.uhgg.len\\n    bedtools genomecov -i ${infile}.uhgg.bed -g ${infile}.uhgg.len |awk 'BEGIN {FS=\\\"\\\\t\\\"} $2\\u003e=1 {print $0}'|grep -v \\\"genome\\\" \\u003e ${infile}.uhgg.bedtools\\n\\n    awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e90 {print $1 \\\"\\\\t\\\" $7 \\\"\\\\t\\\" $8 }' ./${infile}.uhgg.pro.m8.tab |sort -k 1 -t $'\\\\t' |sed 's/[[:space:]]*$//'|tr -d \\\" \\\"|sort -k1,1 -k2,2n\\u003e ${infile}.uhgg.pro.bed.1\\n    bedtools merge -i ${infile}.uhgg.pro.bed.1 \\u003e${infile}.uhgg.pro.bed\\n    bedtools genomecov -i ${infile}.uhgg.pro.bed -g ${infile}.uhgg.len |awk 'BEGIN {FS=\\\"\\\\t\\\"} $2\\u003e=1 {print $0}'|grep -v \\\"genome\\\" \\u003e ${infile}.uhgg.pro.bedtools\\n\\n\\n    while read -r lenf \\n    do \\n        name=`echo $lenf |awk 'BEGIN {FS=\\\" \\\"} {print $1}'`\\n        len=`echo $lenf |awk 'BEGIN {FS=\\\" \\\"} {print $2}'`\\n        line=`grep -w \\\"$name\\\" $infile.uhgg.bedtools`\\n        pct=0\\n        if [ `grep -w \\\"$name\\\" $infile.uhgg.bedtools|wc -l` == 1 ];then\\n            pct=`echo $line |awk 'BEGIN {FS=\\\" \\\"} {print $NF}'|awk '{printf(\\\"%f\\\",$0)} '`\\n        fi\\n        pct2=0\\n        if [ `grep \\\"$name\\\" ${infile}.uhgg.pro.bedtools|wc -l` == 1 ];then\\n            pct2=`grep \\\"$name\\\" ${infile}.uhgg.pro.bedtools |awk 'BEGIN {FS=\\\" \\\"}  {print $NF}'|awk '{printf(\\\"%f\\\",$0)} '`\\n        fi\\n        pct3=`echo \\\"$pct-$pct2\\\"|bc`\\n        if [ $(echo \\\"$pct3 \\u003c 0\\\"|bc) -eq 1 ];then\\n            pct3=0\\n        fi\\n        echo \\\"$name,$pct3,$len\\\"\\n    done \\u003c \\\"${infile}.uhgg.len\\\" \\u003e ${infile}.np90.csv\\n    awk 'BEGIN {FS=\\\",\\\"wc} $2\\u003e0.5' CHGV.np90.csv|wc\\n    awk 'BEGIN {FS=\\\",\\\"} $2\\u003e0.5 {print $1}' UHGG.filtered/CHGV.np90.csv \\u003e UHGG.filtered/CHGV.uhgg.txt\\n    seqkit grep -v -f UHGG.filtered/CHGV.uhgg.txt CHGV.filtered.fa \\u003e CHGV.filtered.uhgg.fa\\n\\n\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"5","cases":[],"critical":null},{"id":1764409,"guid":"E7B474A03A9711EEBCD1D1346B10DCE9","previous_id":1764408,"previous_guid":"D9C604D03A9711EEBCD1D1346B10DCE9","section":"\u003cp\u003eAdditional analysis\u003c/p\u003e","section_color":"#94EBFF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"697u7\",\"text\":\"checkv\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":6},{\"style\":\"italic\",\"offset\":0,\"length\":6}],\"entityRanges\":[],\"data\":{}},{\"key\":\"ap8fc\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"d7msj\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"23cbn\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"c3cqu\",\"text\":\"infile=$1\\nexport CHECKVDB=/mnt/raid6/sunchuqing/Softwares/checkv/checkv-db-v0.6\\nexport PATH=/mnt/raid6/sunchuqing/Softwares/miniconda3/bin:$PATH\\nawk '/^\\u003e/\\u0026\\u0026NR\\u003e1{print \\\"\\\";}{ printf \\\"%s\\\",/^\\u003e/ ? $0\\\" \\\":$0 }'  00_CAT/${infile}_cdhit.fa |awk 'length($NF)\\u003e=1500 {print $1\\\"\\\\n\\\"$NF}' \\u003e 00_CAT/${infile}_cdhit.len1.5k.fa\\n\\nmkdir -p 05_checkV/${infile}_1.5k\\n/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/checkv contamination 00_CAT/${infile}_cdhit.len1.5k.fa 05_checkV/${infile}_1.5k -t 16\\n/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/checkv completeness 00_CAT/${infile}_cdhit.len1.5k.fa 05_checkV/${infile}_1.5k -t 16\\n/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/checkv complete_genomes  00_CAT/${infile}_cdhit.len1.5k.fa 05_checkV/${infile}_1.5k \\n/mnt/raid6/sunchuqing/Softwares/miniconda3/bin/checkv quality_summary 00_CAT/${infile}_cdhit.len1.5k.fa 05_checkV/${infile}_1.5k \",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"6","cases":[],"critical":null},{"id":1764410,"guid":"007520203A9811EEBCD1D1346B10DCE9","previous_id":1764409,"previous_guid":"E7B474A03A9711EEBCD1D1346B10DCE9","section":"\u003cp\u003eAdditional analysis\u003c/p\u003e","section_color":"#94EBFF","section_duration":0,"is_substep":false,"step":"{\"blocks\":[{\"key\":\"17sk\",\"text\":\"RPKM calculation\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[{\"style\":\"bold\",\"offset\":0,\"length\":16},{\"style\":\"italic\",\"offset\":0,\"length\":16}],\"entityRanges\":[],\"data\":{}},{\"key\":\"5msq0\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}},{\"key\":\"3aock\",\"text\":\" \",\"type\":\"atomic\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[{\"key\":0,\"offset\":0,\"length\":1}],\"data\":{}},{\"key\":\"qb2r\",\"text\":\"\",\"type\":\"unstyled\",\"depth\":0,\"inlineStyleRanges\":[],\"entityRanges\":[],\"data\":{}}],\"entityMap\":{\"0\":{\"type\":\"code_insert\",\"mutability\":\"IMMUTABLE\",\"data\":{\"blocks\":[{\"data\":{},\"depth\":0,\"entityRanges\":[],\"inlineStyleRanges\":[],\"key\":\"4lkrj\",\"text\":\"#prevalence.RPKM\\ndb=CHGV.filtered\\nseq=CHGV.filtered.fa\\n# bowtie2-build $seq db/$db\\nwhile read -r infile\\ndo\\n    path=\\\"$NGS/\\\"\\n    R1=`ls $path/$infile*R1*|head -n1`\\n    R2=`ls $path/$infile*R2*|head -n1`\\n    if [ -s 04_mapping/${infile}_NGS.bam ];then\\n        echo \\\"Mapped $infile\\\"\\n        continue\\n    fi\\n    $Software/miniconda3/bin/bowtie2 -x db/$db \\\\\\n        -1 $R1\\\\\\n        -2 $R2 \\\\\\n        -S 04_mapping/${infile}_NGS.sam -p 8\\n    samtools view -bS 04_mapping/${infile}_NGS.sam \\u003e 04_mapping/${infile}_NGS.bam\\n    rm 04_mapping/${infile}_NGS.sam\\ndone \\u003c \\\"sam.list\\\"\\n\\n\\nwhile read -r infile\\ndo\\n    if [ ! -s 04_mapping/${infile}_NGS.bam ];then\\n        echo \\\"Unmapped $infile\\\"\\n        continue\\n    fi\\n    if [ ! -s 06_bamst_cov/${infile}/chromosomes.report ];then\\n        echo \\\"Bamdst $infile\\\"\\n        mkdir -p 06_bamst_cov/${infile}\\n        output=06_bamst_cov/${infile}\\n        samtools sort -@4 04_mapping/${infile}_NGS.bam -o 04_mapping/${infile}_NGS.sort.bam\\n        cd $output\\n        $Software/bamdst/bamdst -p ../../CHGV.bed -o ./ ../../04_mapping/${infile}_NGS.sort.bam\\n        cut -f 1,6 chromosomes.report|sed \\\"s/^/${infile}\\\\t/\\\"|awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e=50' \\u003e\\u003e  ../Sample.4x.50.cov.tbl\\n        cut -f 1,6 chromosomes.report|sed \\\"s/^/${infile}\\\\t/\\\"|awk 'BEGIN {FS=\\\"\\\\t\\\"} $3\\u003e=50'|cut -f 2 \\u003e ./$infile.4x.50.cov.list\\n        grep -wFf ./$infile.4x.50.cov.list ../../CHGV.bed \\u003e ./$infile.4x.50.cov.bed\\n        cd ../..\\n    fi\\n    if [ ! -s 07_bam2rpkm/${infile}.rpkm.txt ];then\\n        echo \\\"Bam2rpkm $infile\\\"\\n            mkdir -p 07_bam2rpkm/\\n        rm -r 07_bam2rpkm/$infile.rpkm.txt\\n        bam=04_mapping/${infile}_NGS.sort.bam\\n        samtools index -@4 $bam\\n        bed=06_bamst_cov/${infile}/${infile}.4x.50.cov.bed\\n        echo $infile\\n        export total_reads=$(samtools idxstats  $bam|awk -F '\\\\t' '{s+=$3}END{print s}')\\n        echo The number of reads is $total_reads\\n        bedtools multicov -bams  $bam -bed $bed |\\\\\\n            perl -alne '{$len=$F[2]-$F[1];if($len \\u003c1 ){print \\\"$.\\\\t$F[3]\\\\t0\\\" }else{$rpkm=(1000000000*$F[3]/($len* $ENV{total_reads}));print \\\"$F[0]\\\\t$F[3]\\\\t$rpkm\\\"}}' |\\\\\\n            sed \\\"s/^/${infile}\\\\t/\\\" \\u003e07_bam2rpkm/${infile}.rpkm.txt\\n    fi\\ndone \\u003c \\\"sam.list\\\"\\n\\n\\n\\n\",\"type\":\"unstyled\"}],\"entityMap\":{}}}}}","data":null,"protocol_id":86442,"case_id":0,"critical_ids":"","duration":0,"original_id":0,"number":"7","cases":[],"critical":null}],"template_id":5,"title":"Efficient recovery of complete gut viral genomes by combined short- and long-read sequencing","title_html":"Efficient recovery of complete gut viral genomes by combined short- and long-read sequencing","type_id":1,"units":[{"id":1,"type_id":3,"name":"µL","can_manage":0,"read_only":0},{"id":2,"type_id":3,"name":"mL","can_manage":0,"read_only":0},{"id":3,"type_id":3,"name":"L","can_manage":0,"read_only":0},{"id":4,"type_id":3,"name":"µg","can_manage":0,"read_only":0},{"id":5,"type_id":3,"name":"mg","can_manage":0,"read_only":0},{"id":6,"type_id":3,"name":"g","can_manage":0,"read_only":0},{"id":7,"type_id":3,"name":"kg","can_manage":0,"read_only":0},{"id":8,"type_id":3,"name":"ng","can_manage":0,"read_only":0},{"id":9,"type_id":3,"name":"Hz","can_manage":0,"read_only":0},{"id":10,"type_id":24,"name":"°C","can_manage":0,"read_only":0},{"id":11,"type_id":24,"name":"°К","can_manage":0,"read_only":0},{"id":12,"type_id":24,"name":"°F","can_manage":0,"read_only":0},{"id":13,"type_id":25,"name":"Mass Percent","can_manage":0,"read_only":0},{"id":14,"type_id":25,"name":"% volume","can_manage":0,"read_only":0},{"id":15,"type_id":25,"name":"Mass / % volume","can_manage":0,"read_only":0},{"id":16,"type_id":25,"name":"Parts per Million (PPM)","can_manage":0,"read_only":0},{"id":17,"type_id":25,"name":"Parts per Billion (PPB)","can_manage":0,"read_only":0},{"id":18,"type_id":25,"name":"Parts per Trillion (PPT)","can_manage":0,"read_only":0},{"id":19,"type_id":25,"name":"Mole Fraction","can_manage":0,"read_only":0},{"id":20,"type_id":25,"name":"Mole Percent","can_manage":0,"read_only":0},{"id":21,"type_id":25,"name":"Molarity (M)","can_manage":0,"read_only":1},{"id":22,"type_id":25,"name":"Molarity (m)","can_manage":0,"read_only":0},{"id":23,"type_id":25,"name":"Genome copies per ml","can_manage":0,"read_only":0},{"id":24,"type_id":3,"name":"μV","can_manage":0,"read_only":0},{"id":25,"type_id":3,"name":"ms","can_manage":0,"read_only":0},{"id":26,"type_id":3,"name":"pg","can_manage":0,"read_only":0},{"id":27,"type_id":25,"name":"Molarity dilutions","can_manage":0,"read_only":0},{"id":28,"type_id":25,"name":"millimolar (mM)","can_manage":0,"read_only":0},{"id":29,"type_id":25,"name":"micromolar (µM)","can_manage":0,"read_only":0},{"id":30,"type_id":25,"name":"nanomolar (nM)","can_manage":0,"read_only":0},{"id":31,"type_id":25,"name":"picomolar (pM)","can_manage":0,"read_only":0},{"id":32,"type_id":24,"name":"Room temperature","can_manage":0,"read_only":0},{"id":33,"type_id":30,"name":"rpm","can_manage":0,"read_only":0},{"id":34,"type_id":30,"name":"x g","can_manage":0,"read_only":0},{"id":165,"type_id":24,"name":"On ice","can_manage":0,"read_only":0},{"id":200,"type_id":32,"name":"cm","can_manage":0,"read_only":0},{"id":201,"type_id":32,"name":"mm","can_manage":0,"read_only":0},{"id":202,"type_id":32,"name":"µm","can_manage":0,"read_only":0},{"id":203,"type_id":32,"name":"nm","can_manage":0,"read_only":0},{"id":204,"type_id":25,"name":"mg/mL","can_manage":0,"read_only":0},{"id":205,"type_id":25,"name":"µg/µL","can_manage":0,"read_only":0},{"id":206,"type_id":25,"name":"% (v/v)","can_manage":0,"read_only":0},{"id":1324,"type_id":30,"name":"rcf","can_manage":0,"read_only":0},{"id":1359,"type_id":35,"name":"Bar","can_manage":0,"read_only":0},{"id":1360,"type_id":35,"name":"Pa","can_manage":0,"read_only":0}],"uri":"efficient-recovery-of-complete-gut-viral-genomes-b-cynixvce","url":"https://www.protocols.io/view/efficient-recovery-of-complete-gut-viral-genomes-b-cynixvce","version_class":86442,"version_data":{"id":0,"code":"cynixvce","version_class":86442,"parent_id":null,"parent_uri":null,"is_same_owner":false,"is_parent_public":false,"has_pending_merge_request":false,"has_approved_merge_request":false,"merge_request":null},"version_id":0,"version_uri":"efficient-recovery-of-complete-gut-viral-genomes-b-36wgq339klk5/v1","versions":[{"id":86442,"title":"Efficient recovery of complete gut viral genomes by combined short- and long-read sequencing","title_html":"Efficient recovery of complete gut viral genomes by combined short- and long-read sequencing","image":{"source":"https://www.protocols.io/img/default_protocol.png","webp_source":null,"placeholder":"https://www.protocols.io/img/default_protocol.png","webp_placeholder":null},"doi":"dx.doi.org/10.17504/protocols.io.36wgq339klk5/v1","uri":"efficient-recovery-of-complete-gut-viral-genomes-b-cynixvce","published_on":1692029558,"modified_on":1692029558,"version_class":86442,"version_id":0,"version_code":"cynixvce","version_uri":"efficient-recovery-of-complete-gut-viral-genomes-b-36wgq339klk5/v1","created_on":1692013029,"categories":null,"type_id":1,"creator":{"name":"chuqingsun","affiliation":null,"affiliation_url":null,"username":"n4ule102q1w4ule1","link":null,"image":{"source":"/img/avatars/007.png","placeholder":"/img/avatars/007.png","webp_source":""}},"stats":{"number_of_comments":0,"last_comment_time":0}}],"warning":""}